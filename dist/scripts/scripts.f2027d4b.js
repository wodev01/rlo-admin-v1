"use strict";var app=angular.module("rloAdminApp",["ngAnimate","ngCookies","ngSanitize","ui.router","ngMaterial","ui.grid","ui.grid.selection","ui.grid.autoResize","ui.grid.pagination","ui.grid.exporter","ngWYSIWYG","angular-bind-html-compile","angular.filter","mdDateTime"]).constant("cookieName","cargly_rloAdmin_access_token").constant("toastr",toastr).constant("localStorage",localStorage).constant("pagingOptions",["5","10","25","50","100"]).constant("globalTimeZone",["US/Hawaii","US/Alaska","US/Pacific","US/Arizona","US/Mountain","US/Central","US/Eastern"]);app.config(["$httpProvider","$mdThemingProvider","$stateProvider","$urlRouterProvider","toastr",function(a,b,c,d,e){a.interceptors.push("InterceptorsService"),b.definePalette("rloPalette",{50:"C0C9E5",100:"B8C2E0",200:"A5B4E2",300:"8dA2E0",400:"6C8AE2",500:"5B7BE3",600:"476DE0",700:"3762E5",800:"2454E5",900:"0F44E2",A100:"82B1FF",A200:"448AFF",A400:"2979FF",A700:"2962FF",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0}),b.theme("rlo").primaryPalette("rloPalette").accentPalette("grey",{"default":"900"}).warnPalette("red"),b.theme("grey").primaryPalette("grey").accentPalette("indigo"),b.setDefaultTheme("rlo"),b.alwaysWatchTheme(!0),e.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!0,positionClass:"toast-top-right",preventDuplicates:!0,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},d.otherwise("/clients"),c.state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("resetPassword",{url:"/reset-password",templateUrl:"views/resetPassword.html",controller:"ResetPasswordCtrl",resolve:{AuthService:["AuthService",function(a){return a.fnResetPWTokenVerified()}]}}).state("main",{"abstract":!0,url:"/",controller:"MainCtrl",templateUrl:"views/authenticated/main.html"}).state("main.clients",{url:"clients",templateUrl:"views/authenticated/clients/clients.html",controller:"clientsCtrl",resolve:{AuthService:["AuthService",function(a){return a.fnGetUser()}]}}).state("main.payments",{url:"payments",templateUrl:"views/authenticated/payments/payments.html",controller:"paymentsCtrl",resolve:{AuthService:["AuthService",function(a){return a.fnGetUser()}]}}).state("main.groups",{url:"groups",templateUrl:"views/authenticated/shopGroups/groups.html",controller:"groupsCtrl",resolve:{AuthService:["AuthService",function(a){return a.fnGetUser()}]}}).state("main.shopLocations",{url:"shop-locations",templateUrl:"views/authenticated/shopLocations/shopLocations.html",controller:"shopLocationsCtrl",resolve:{AuthService:["AuthService",function(a){return a.fnGetUser()}]}}).state("main.settings",{url:"settings/:settingsName",templateUrl:"views/authenticated/settings/settings.html",controller:"settingsCtrl",resolve:{AuthService:["AuthService",function(a){return a.fnGetUser()}]}})}]),app.run(["$rootScope","$mdDialog","$mdSidenav","$cookies","cookieName",function(a,b,c,d,e){a.fnReturnGridHeight=function(a,b,c,d){var e=50,f=30,g=32,h=18,i=f+(d?25:0),j=a*(b?b:e)+h,k=c?g:0;return{height:i+j+k+"px"}},a.fnCancelSearchFilter=function(a,b){27===a.keyCode&&b.searchForm.searchFilter.$rollbackViewValue()},a.fnCloseSideNavs=function(){var a=angular.element("md-sidenav");angular.forEach(a,function(a){var b=angular.element(a).attr("md-component-id");c(b).isOpen()&&c(b).close().then(function(){})})},CarglyPartner.configure({applicationId:"UoLKXYzKpidrWeCjosCKGvcrs5sObIA2",appLabel:"rloAdmin",onTwoMinWarning:function(){var a=["$scope","$mdDialog","$interval",function(a,b,c){a.countdown,a.minRemaining=60,a.fnCloseDialog=function(){b.cancel()};c(function(){0===a.countdown&&(c.cancel(),a.fnCloseDialog()),a.countdown-=1},1e3);a.$watch("countdown",function(b){a.minRemaining=parseInt(b/60)+1}),a.extendSession=function(){a.fnCloseDialog(),CarglyPartner.extendSession(function(){},function(){})}}],c=d.get(e);c&&b.show({controller:a,templateUrl:"views/modals/idleSession.tmpl.html",clickOutsideToClose:!1})},onAuthChanged:function(){}});var f={Android:function(){return navigator.userAgent.match(/Android/i)||navigator.platform.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)||navigator.platform.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)||navigator.platform.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return f.Android()||f.BlackBerry()||f.iOS()||f.Opera()||f.Windows()}};a.isMobile=f.any()}]),app.directive("locationIndicator",function(){return{restrict:"A",scope:{obj:"="},template:'<md-tooltip md-direction="top">{{msg}}</md-tooltip>',link:function(a,b){a.msg="",b.addClass("checked_item_"),a.$watch("obj",function(c){if(c.lastConfig="string"==typeof c.lastConfig?JSON.parse(c.lastConfig):c.lastConfig,null!==c.lastConfig){var d=c.lastConfig.settings;if("yes"===d["carglyconnect.syncenabled"]?(b[0].className=b[0].className.replace(/checked_item_(.*)/,"checked_item_green"),void 0!==a.msg&&(a.msg="Synchronization is enabled")):"no"===d["carglyconnect.syncenabled"]&&(b[0].className=b[0].className.replace(/checked_item_(.*)/,"checked_item_yellow"),void 0!==a.msg&&(a.msg="Synchronization is disabled.")),""!==d["carglyconnect.lastsync"]){var e=new Date(d["carglyconnect.lastsync"]),f=new Date(Date.now()),g=Math.abs(f.getTime()-e.getTime()),h=Math.ceil(g/864e5);h>3&&(b[0].className=b[0].className.replace(/checked_item_(.*)/,"checked_item_red"),void 0!==a.msg&&(a.msg="Not sync'd something is wrong."))}}else null===c.lastConfig&&(b[0].className=b[0].className.replace(/checked_item_(.*)/,"checked_item_gray"),void 0!==a.msg&&(a.msg="Not sync'd something is wrong."))})}}}),app.directive("multipleEmails",function(){function a(a,e,f){var g=a.$isEmpty(f)||f.split(",").every(function(a){return c.test(a.trim())});return g?(d=f?f.split(","):[],a.$setValidity(e,g),b(d)?void 0:f):void 0}function b(a){for(var b=a.sort(),c=0;c<a.length-1;c++)if(b[c+1]===b[c])return!0}var c=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,d=[];return{restrict:"A",require:"ngModel",link:function(b,c,d,e){function f(b){return a(e,"multipleEmails",b)}e.$formatters.push(f),e.$parsers.push(f)}}}),app.directive("addDescription",function(){return{restrict:"A",scope:{arr:"="},link:function(a,b){var c="";angular.forEach(a.arr,function(a){c+='<div style="margin: 10px;">'+a.description+"</div>"}),b.append(c)}}}),app.directive("addTooltip",["$filter",function(a){return{restrict:"A",scope:{obj:"=",rowIndex:"="},templateUrl:"views/authenticated/shopLocations/tooltip.html",link:function(b,c){b.recRepairArr=b.obj.entity.recent_repair_orders.length>0?b.obj.entity.recent_repair_orders:[],b.recent_repair_orders_obj=b.recRepairArr[0],b.position=b.obj.entity.recent_repair_orders.indexOf(b.recent_repair_orders_obj),b.fnMove=function(a){b.position+=a,b.recent_repair_orders_obj=b.recRepairArr[b.position]};var d="#view_ul"+b.rowIndex;c.blur(function(){angular.element(d).removeClass("add-display-block")}),c.hover(function(){angular.element(d).addClass("add-display-block"),angular.element(d).parent().addClass("top-arrow"),b.rowIndex>6?(angular.element(d).css("margin-top","-350px"),angular.element(".grid-tooltip .has-sub ul").css("bottom","0px"),angular.element(d).parent().addClass("bottom-arrow"),angular.element("#rs-grid").css("padding-bottom","")):(angular.element("#rs-grid .ui-grid-viewport").css("overflow-x",""),angular.element("#rs-grid .ui-grid-viewport").css("overflow-y",""),angular.element("#rs-grid .ui-grid-viewport").css("overflow","visible"),angular.element(".grid-tooltip .has-sub ul").css("bottom",""),angular.element(d).css("margin-top","0px"),angular.element(d).parent().addClass("top-arrow"),angular.element("#rs-grid").css("padding-bottom","340px"))},function(){angular.element(d).removeClass("add-display-block"),angular.element(d).parent().removeClass("top-arrow"),angular.element(d).parent().removeClass("bottom-arrow"),angular.element("#rs-grid").css("padding-bottom",""),angular.element("#rs-grid .ui-grid-viewport").css("overflow",""),angular.element("#rs-grid .ui-grid-viewport").css("overflow-x","auto"),angular.element("#rs-grid .ui-grid-viewport").css("overflow-y","hidden")}),angular.forEach(b.obj.entity.recent_labor,function(c){angular.element("#table"+b.obj.rowIndex).append("<tr><td>"+c.repair_order+"</td><td>"+a("date")(c.closed,"M/d/yyyy h:mm a")+"</td><td>"+c.description+"</td></tr>")})}}}]),app.directive("jsonText",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){if(a&&""!==a.trim()){try{g=angular.fromJson(a),d.$setValidity("invalidJson",!0)}catch(b){d.$setValidity("invalidJson",!1)}return g}return{}}function f(a){return angular.toJson(a,!0)}var g;d.$parsers.push(e),d.$formatters.push(f),b.bind("blur",function(){b.val(f(a.$eval(c.ngModel))),d.$render()}),a.$watch(c.ngModel,function(a,b){g=g||a,a!=b&&d.$setViewValue(f(a))},!0)}}}),app.filter("CentToDollar",function(){return function(a){return(a/100).toFixed(2)}}),app.filter("joinArray",function(){return function(a){return a?a.join(", "):""}}),app.filter("joinArrayOfObj",function(){return function(a){var b=[];return angular.forEach(a,function(a){b.push(a.name)}),b.join(", ")}}),app.filter("inspection",function(){return function(a){return"undefined"==typeof a||null===a||""===a?"NO":"YES"}}),app.filter("tel",function(){return function(a){if(!a)return"";var b=a.toString().trim().replace(/^\+/,"");if(b.match(/[^0-9]/))return a;var c,d,e;switch(b.length){case 10:c=1,d=b.slice(0,3),e=b.slice(3);break;case 11:c=b[0],d=b.slice(1,4),e=b.slice(4);break;case 12:c=b.slice(0,3),d=b.slice(3,5),e=b.slice(5);break;default:return a}return 1===c&&(c=""),e=e.slice(0,3)+"-"+e.slice(3),(c+" ("+d+") "+e).trim()}}),app.filter("joinTelArray",["$filter",function(a){return function(b){return"string"==typeof b?b:(angular.forEach(b,function(c,d){b[d]=a("tel")(c)}),b.join(", "))}}]),app.filter("sumOfValue",function(){return function(a,b){if("undefined"==typeof a&&"undefined"==typeof b)return 0;for(var c=0,d=0;d<a.length;d++)c+=a[d][b];return c}}),app.filter("toHHMMSS",function(){return function(a){var b=parseInt(a,10),c=Math.floor(b/3600),d=Math.floor((b-3600*c)/60),e=b-3600*c-60*d;return 10>c&&(c="0"+c),10>d&&(d="0"+d),10>e&&(e="0"+e),c+":"+d+":"+e}}),app.filter("hour",function(){return function(a){return(a/3600).toFixed(2)}}),app.filter("multiplyBy100",function(){return function(a){return(100*a).toFixed(2)}}),app.filter("calEffectiveRate",function(){return function(a){return(3600*a/100).toFixed(2)}}),app.filter("toFloor",function(){return function(a){return Math.floor(a)}}),app.factory("InterceptorsService",["$cookies","$q","$injector","$stateParams","$location","cookieName","toastr",function(a,b,c,d,e,f,g){return{request:function(d){var g=a.get(f),h=b.defer();if(g)if("/login"===e.path()||"/resetPassword"===e.path()){var i=c.get("$state"),j=c.get("$stateParams");""!==i.current.name?"login"===i.current.name||"/resetPassword"===i.current.name?e.url("/clients"):i.go(i.current.name,j):e.url("/clients")}else h.resolve(d);else null!=CarglyPartner.queryParams&&null!=CarglyPartner.queryParams.resetpw&&""!=CarglyPartner.queryParams.resetpw?(e.url("/reset-password"),h.resolve(d)):(e.url("/login"),h.resolve(d));return h.promise},response:function(a){return a},responseError:function(d){var e=b.defer();return 401===d.status||403===d.status?(401===d.status?g.error("Username and password are wrong."):g.error("Do not have permission."),a.remove(f),c.get("$state").transitionTo("login"),e.reject(d)):e.reject(d),e.promise}}}]),app.factory("encodeParamService",function(){var a={};return a.getEncodedParams=function(a){var b=[];for(var c in a)"undefined"!=typeof a[c]&&null!==a[c]&&""!==a[c]&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return 0==b.length?b.join("&"):"?"+b.join("&")},a}),app.factory("ErrorMsg",["$state","toastr","$cookies","cookieName",function(a,b,c,d){function e(){CarglyPartner.logout(function(){c.remove(d),a.go("login")},function(){})}var f={};return f.CheckStatusCode=function(a){switch(a){case 401:b.remove(),b.error("Access is denied due to invalid credentials.","401 - Unauthorized"),e();break;case 403:b.remove(),b.error("Do not have permission.","403 - Forbidden"),e();break;case 500:b.error("An unexpected error has occurred. Please refresh the page and try again.","STATUS CODE: 500")}},f}]),app.factory("AuthService",["$q","$location","$cookies","$rootScope","cookieName","ErrorMsg",function(a,b,c,d,e,f){var g={};return g.fnGetUser=function(){var b=c.get(e),g=a.defer();return CarglyPartner._getUser(b,function(a){d.isSettingsUpdatesTabShown="Super"===a.role,g.resolve(a)},function(a){a&&f.CheckStatusCode(a.status)}),g.promise},g.fnResetPWTokenVerified=function(){var c=a.defer();return null!=CarglyPartner.queryParams&&null!=CarglyPartner.queryParams.resetpw&&""!=CarglyPartner.queryParams.resetpw?c.resolve():(b.url("/login"),c.resolve()),c.promise},g}]),app.factory("locationService",["$q","ErrorMsg",function(a,b){var c={};c.fetchLocation=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations",type:"GET",success:function(a){c.resolve(a)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise},c.deleteLocation=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c,type:"DELETE",data:null,success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.saveLocation=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations"+(c?"/"+c:""),type:"POST",data:d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.repairOrder=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/events",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise};var d={};return c.setLocationObj=function(a){d=a},c.getLocationObj=function(){return d},c}]),app.factory("clientService",["$q","ErrorMsg","encodeParamService",function(a,b,c){var d={},e="";d.fetchClients=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/clients",type:"GET",success:function(a){c.resolve(a)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise},d.fetchClientsUsingStatusFilter=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/clients"+(c?"?status="+c:""),type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},d.fetchClientsUsingFilter=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/clients"+(c?"?filter="+c:""),type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},d.filterClientsData=function(d){var f=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/clients"+c.getEncodedParams(d),type:"GET",success:function(a,b,c){e=c["x-paging-cursor"];var d={};d.data=a,d.status=b,d.headers=c,f.resolve(d)},error:function(a){b.CheckStatusCode(a.status),f.reject(a)}}),f.promise},d.saveClient=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/clients",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.reject(a)}}),d.promise},d.updateClientInfo=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/details",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.reject(a)}}),e.promise},d.fetchMoreClients=function(){var d=a.defer(),f={};return f.cursor=e,CarglyPartner.ajax({url:"/partners/api/agent/clients"+c.getEncodedParams(f),type:"GET",success:function(a,b,c){e=c["x-paging-cursor"];var f={};f.data=a,f.status=b,f.headers=c,d.resolve(f)},error:function(a){b.CheckStatusCode(a.status),d.reject(a)}}),d.promise};var f={};return d.setClientObj=function(a){f=a},d.getClientObj=function(){return f},d}]),app.factory("clientUsersService",["$q","ErrorMsg",function(a,b){var c={};c.fetchUsersByPartnerId=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/users",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.reject(a)}}),d.promise},c.reconfirm=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/account/"+c+"/reconfirm",type:"POST",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.requestPasswordReset=function(c){var d=a.defer();return CarglyPartner.requestPasswordReset(c,function(a){d.resolve(a)},function(a){b.CheckStatusCode(a.status),d.resolve(a)}),d.promise},c.createUser=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/users",type:"POST",data:d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.reject(a)}}),e.promise},c.sendWelcomeEmail=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/sendWelcomeEmail",type:"POST",data:{email:c},success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.updateUser=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/users"+(c?"/"+c:""),type:"POST",data:d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.reject(a)}}),e.promise};var d={};return c.setUserObj=function(a){d=a},c.getUserObj=function(){return d},c}]),app.factory("clientLocationService",["$q","ErrorMsg",function(a,b){var c={};c.fetchLocations=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/locations",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.reject(a)}}),d.promise},c.createLocation=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/locations",type:"POST",data:d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.updateLocation=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations"+(c?"/"+c:""),type:"POST",data:d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise};var d={};return c.setLocationObj=function(a){d=a},c.getLocationObj=function(){return d},c}]),app.factory("clientBillingServices",["$q","ErrorMsg",function(a,b){var c={};return c.fetchClientPaymentInfo=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/payment-info",type:"GET",data:null,success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.fetchClientPayments=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/payments",type:"GET",data:null,success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.fetchClientSubscriptionInfo=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/subscription-info",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.saveClientSubscriptionInfo=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/subscription-info",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.updateClientPaymentInfo=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/payment-info",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.saveInvoice=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/payments",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.refundPayment=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/payments/"+d+"/refund",type:"POST",contentType:"application/json; charset=utf-8",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c}]),app.factory("clientEmailService",["$q","$rootScope","encodeParamService","ErrorMsg",function(a,b,c,d){var e={};e.fetchClientEmails=function(b,e){var f=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+b+"/emails"+c.getEncodedParams(e),type:"GET",success:function(a){f.resolve(a)},error:function(a){d.CheckStatusCode(a.status),f.reject(a)}}),f.promise};var f={};return e.setClientEmailObj=function(a){f=a},e.getClientEmailObj=function(){return f},e}]),app.factory("clientPaymentsServices",["$q","ErrorMsg",function(a,b){var c={};return c.fetchClientPayments=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/client-payments",type:"GET",success:function(a){c.resolve(a)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise},c}]),app.factory("paymentService",["$q","ErrorMsg",function(a,b){var c={};return c.fetchUserPaymentInfo=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+CarglyPartner.user.partnerId+"/payment-info",type:"GET",success:function(a){c.resolve(a)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise},c.savePaymentInfo=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+CarglyPartner.user.partnerId+"/payment-info",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(c)}}),d.promise},c.fetchPayment=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+CarglyPartner.user.partnerId+"/payments",type:"GET",success:function(a){c.resolve(a)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise},c.savePayment=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+CarglyPartner.user.partnerId+"/payments",type:"POST",data:c,success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c}]),app.factory("groupService",["$q","ErrorMsg",function(a,b){var c={};c.fetchGroups=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/groups",type:"GET",success:function(a){c.resolve(a)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise},c.fetchOneGroup=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/groups/"+c,type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.fetchGroupsForPartnerLoc=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/client-locations",type:"GET",data:c,success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.filterPartnerLocUseGroup=function(c){var d=a.defer();return CarglyPartner.ajax({url:" /partners/api/agent/client-locations?group_id="+c,type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.createGroup=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/groups",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.editGroup=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:" /partners/api/groups/"+c,type:"PUT",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.deleteGroup=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/groups/"+c,type:"DELETE",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.fetchClients=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/clients",type:"GET",success:function(a){c.resolve(a)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise},c.fetchClientsUsingFilter=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/clients?filter="+c,type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.addMemberPartnerToGroup=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/groups/"+c+"/members/"+d,type:"POST",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.deleteMemberPartnerFromGroup=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/groups/"+c+"/members/"+d,type:"DELETE",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.fetchGroupMembers=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/groups/"+c+"/members",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise};var d={};return c.setGroupObj=function(a){d=a},c.getGroupObj=function(){return d},c}]),app.factory("shopLocationsService",["$q","ErrorMsg","encodeParamService",function(a,b,c){var d={},e="";d.fetchShopLocations=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/client-locations"+(c?"?group_id="+c:""),type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},d.filterShopLocationsData=function(d){var f=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/client-locations"+c.getEncodedParams(d),type:"GET",success:function(a,b,c){e=c["x-paging-cursor"];var d={};d.data=a,d.status=b,d.headers=c,f.resolve(d)},error:function(a){b.CheckStatusCode(a.status),f.resolve(a)}}),f.promise},d.saveShopLocations=function(c,d){var e=a.defer();return 0===c.length&&(c=null),CarglyPartner.ajax({url:"/partners/api/agent/client-locations"+(c?"/"+c:""),type:"POST",data:d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.fetchShopLocationEvents=function(c,d){var e=a.defer();return 0===c.length&&(c=null),CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/events",type:"GET",data:"pageNum="+d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.updateShopLocationNextConfig=function(c,d){var e=a.defer();return 0===c.length&&(c=null),CarglyPartner.ajax({url:"/partners/api/agent/client-locations/"+c+"/next-config",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.sendDailyEmail=function(d,e){var f=a.defer(),g={};return g.year=e,0===d.length&&(d=null),CarglyPartner.ajax({url:"/partners/api/locations/"+d+"/email-reports/daily-email/send"+c.getEncodedParams(g),type:"GET",data:null,success:function(a){f.resolve(a)},error:function(a){b.CheckStatusCode(a.status),f.resolve(a)}}),f.promise},d.recommendedService=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/recommended",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},d.repairOrder=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/repair-orders",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},d.fetchLog=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/logs",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},d.fetchNextConfig=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/client-locations/"+c+"/next-config",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},d.saveNextConfig=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/client-locations/"+c+"/next-config",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.customersData=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/customers2"+(d?"?filter="+d:""),type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.customerVehiclesRO=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/vehicles/"+c+"/repair-orders",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},d.customerVehiclesRS=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/vehicles/"+c+"/recommended",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},d.fetchMoreShopLocations=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/client-locations"+(e?"?cursor="+e:""),type:"GET",success:function(a,b,d){e=d["x-paging-cursor"];var f={};f.data=a,f.status=b,f.headers=d,c.resolve(f)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise};var f={};d.setShopLocationsObj=function(a){f=a},d.getShopLocationsObj=function(){return f};var g={};return d.setVehicleObj=function(a){g=a},d.getVehicleObj=function(){return g},d}]),app.factory("shopLocationsDashboardServices",["$q","ErrorMsg","encodeParamService",function(a,b,c){var d={};return d.fetchDailySummary=function(d,e,f){var g=a.defer(),h={};return h.location_id=e,h.year=f,CarglyPartner.ajax({url:"/partners/api/"+d+"/reports/daily_summary"+c.getEncodedParams(h),type:"GET",success:function(a){g.resolve(a)},error:function(a){b.CheckStatusCode(a.status),g.reject(a)}}),g.promise},d.fetchDailySummarySpecificDate=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/daily_summary/"+d,type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.fetchMonthlyData=function(c,d,e){var f=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/monthly/"+e+"/details"+(d?"?location_id="+d:""),type:"GET",success:function(a){f.resolve(a)},error:function(a){b.CheckStatusCode(a.status),f.reject(a)}}),f.promise},d.fetchMonthlySummary=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/monthly_summary"+(d?"?location_id="+d:""),type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.fetchMonthlySummaryWithDateAndLoc=function(c,d,e,f){var g=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/monthly_summary"+(d?"?location_id="+d+"&":"?")+"from="+e+"&to="+f,type:"GET",success:function(a){g.resolve(a)},error:function(a){b.CheckStatusCode(a.status),g.reject(a)}}),g.promise},d.fetchMonthlySummaryWithDate=function(c,d,e){var f=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/monthly_summary?from="+d+"&to="+e,
type:"GET",success:function(a){f.resolve(a)},error:function(a){b.CheckStatusCode(a.status),f.resolve(a)}}),f.promise},d.fetchLocations=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/locations",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.reject(a)}}),d.promise},d.fetchRepairOrderWithDate=function(c,d,e){var f=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/repair-orders"+(d?"?startDate="+d+"&":"")+(e?"endDate="+e:""),type:"GET",success:function(a){f.resolve(a)},error:function(a){b.CheckStatusCode(a.status),f.resolve(a)}}),f.promise},d.fetchTopCustomers=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/top_customers"+(d?"?location_id="+d:""),type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.fetchCustomerReport=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/customers_by_month"+(d?"?location_id="+d:""),type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.fetchMarketingSourceByMonth=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/marketing_sources_by_month"+(d?"?location_id="+d:""),type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.fetchTechStatsByMonth=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/tech_stats_by_month"+(d?"?location_id="+d:""),type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.fetchWriterStatsByMonth=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/writer_stats_by_month"+(d?"?location_id="+d:""),type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d}]),app.factory("accountServices",["$q","ErrorMsg",function(a,b){var c={};return c.fetchAccount=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/account/"+c,type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.updateAccount=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/account"+(c?"/"+c:""),type:"POST",data:d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c}]),app.factory("userService",["$q","ErrorMsg",function(a,b){var c={};c.fetchUsers=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/users",type:"GET",success:function(a){c.resolve(a)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise},c.deleteUser=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/users/"+c,type:"DELETE",data:null,success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.saveUser=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/users"+(c?"/"+c:""),type:"POST",data:d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise};var d={};return c.setUserObj=function(a){d=a},c.getUserObj=function(){return d},c}]),app.factory("subscriptionService",["$q","ErrorMsg",function(a,b){var c={};c.fetchSubscriptions=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/subscription-definitions",type:"GET",success:function(a){c.resolve(a)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise},c.saveSubscription=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/subscription-definitions",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.deleteSubscription=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/subscription-definitions/"+c,type:"DELETE",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise};var d={};return c.setSubscriptionObj=function(a){d=a},c.getSubscriptionObj=function(){return d},c}]),app.factory("updateService",["$q","ErrorMsg",function(a,b){var c={};c.fetchUpdatesDefinitions=function(c,d,e){var f="";c&&d&&e?f="?type="+c+"&page_num="+d+"&page_size="+e:c&&d?f="?type="+c+"&page_num="+d:d&&e?f="?page_num="+d+"&page_size="+e:c&&e?f="?type="+c+"&page_size="+e:c?f="?type="+c:d?f="?filter="+d:e&&(f="?page_size="+e);var g=a.defer();return CarglyPartner.ajax({url:"/partners/api/update-definitions"+f,type:"GET",success:function(a){g.resolve(a)},error:function(a){b.CheckStatusCode(a.status),g.resolve(a)}}),g.promise},c.deleteUpdateDefinitions=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/update-definitions/"+c,type:"DELETE",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.saveUpdateDefinitions=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/update-definitions"+(c?"/"+c:""),type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.fetchUpdates=function(c,d,e,f){var g="";d&&e&&f?g="?type="+d+"&page_num="+e+"&page_size="+f:d&&e?g="?type="+d+"&page_num="+e:e&&f?g="?page_num="+e+"&page_size="+f:d&&f?g="?type="+d+"&page_size="+f:d?g="?type="+d:e?g="?filter="+e:f&&(g="?page_size="+f);var h=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/updates"+g,type:"GET",success:function(a){h.resolve(a)},error:function(a){b.CheckStatusCode(a.status),h.resolve(a)}}),h.promise},c.deleteUpdate=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/updates/"+d,type:"DELETE",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.createUpdate=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/updates",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.fetchUpdateStatuses=function(c,d,e,f){var g="";d&&e&&f?g="?type="+d+"&page_num="+e+"&page_size="+f:d&&e?g="?type="+d+"&page_num="+e:e&&f?g="?page_num="+e+"&page_size="+f:d&&f?g="?type="+d+"&page_size="+f:d?g="?type="+d:e?g="?filter="+e:f&&(g="?page_size="+f);var h=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/update-statuses"+g,type:"GET",success:function(a){h.resolve(a)},error:function(a){b.CheckStatusCode(a.status),h.resolve(a)}}),h.promise},c.createUpdateStatus=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/updates/status",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise};var d={};return c.setUpdateObj=function(a){d=a},c.getUpdateObj=function(){return d},c}]),app.factory("templateService",["$q","ErrorMsg",function(a,b){var c={};c.fetchTemplates=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/email-templates",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.reject(a)}}),d.promise},c.createTemplate=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/email-templates",type:"POST",data:d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.reject(a)}}),e.promise},c.editTemplate=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/email-templates/"+d.id,type:"POST",data:d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.reject(a)}}),e.promise},c.removeTemplate=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/email-templates/"+d,type:"DELETE",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.reject(a)}}),e.promise},c.interpolateTemplate=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/interpolate",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.reject(a)}}),d.promise},c.sendTestEmail=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/send-email",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.reject(a)}}),e.promise};var d={};return c.setTemplateObj=function(a){d=a},c.getTemplateObj=function(){return d},c}]),app.controller("HeaderCtrl",["$scope",function(a){}]),app.controller("LoginCtrl",["$scope","$rootScope","$mdDialog","$state","$stateParams","toastr","ErrorMsg",function(a,b,c,d,e,f,g){a.user={isProcessing:!1},a.fnRefreshDom=function(){a.$$phase||a.$apply()},a.fnSignInUser=function(c){c.isProcessing=!0,CarglyPartner.login(c.email,c.password,function(e){c.isProcessing=!1,a.fnRefreshDom(),"true"===e.verified&&(b.loginUserName=e.name,f.success("Signed in as "+b.loginUserName),d.go("main.clients"))},function(b){c.isProcessing=!1,a.fnRefreshDom(),b&&401!==b.status?g.CheckStatusCode(b.status):f.error("Username and password are wrong.")})},a.fnForgotPassword=function(a){c.show({controller:"ForgotPasswordCtrl",templateUrl:"views/modals/forgotPassword.html",targetEvent:a,clickOutsideToClose:!0})}}]),app.controller("ResetPasswordCtrl",["$scope","$state","$stateParams","$location","toastr",function(a,b,c,d,e){a.pass={isProcessing:!1},a.fnResetPassword=function(a){if(a.password!==a.retypePassword)e.error("Password must be matched.");else{a.isProcessing=!0;var b=angular.copy(a);delete b.isProcessing,CarglyPartner.resetPassword(b,function(){a.isProcessing=!1,e.success("Password changed successfully."),d.url("/login")},function(){a.isProcessing=!1,e.error("Something goe's wrong, while resetting password.")})}return!1}}]),app.controller("ForgotPasswordCtrl",["$scope","$rootScope","$mdDialog","$state","toastr",function(a,b,c,d,e){a.resendEmail="",a.fnHide=function(){c.hide()},a.fnCancel=function(){c.cancel()},a.fnResendMail=function(b){CarglyPartner.requestPasswordReset(b,function(){e.success("Password request send successfully."),a.fnHide()},function(){e.error("Something goe's wrong while sending request."),a.fnHide()})}}]),app.controller("MainCtrl",["$scope","$state","$location","$cookies","$mdSidenav","$mdUtil","cookieName",function(a,b,c,d,e,f,g){a.fnToggleSideNav=function(a){e(a).toggle().then(function(){if(e(a).isOpen()){var b=$(".left-side-nav").parent().find("md-backdrop").first();$(b).css("z-index","61")}})},a.fnIsActive=function(a){return a===c.path()?"md-warn":""},a.fnLogout=function(){CarglyPartner.logout(function(){d.remove(g),b.go("login")},function(){})},a.fnStateSettings=function(){b.go("main.settings",{settingsName:"account"})},a.fnInitMain=function(){CarglyPartner.user&&(a.userObj=CarglyPartner.user)}}]),app.controller("clientsCtrl",["$scope","$rootScope","$timeout","$mdSidenav","groupService","clientService",function(a,b,c,d,e,f){function g(){a.searchFilter="",a.selectStatus=a.selectStatusOptions[0].value,a.getPagedDataAsync(a.selectStatus,a.searchFilter)}a.rightView="views/authenticated/clients/newClient.html",a.rightEditView="views/authenticated/clients/manageClient.html",a.isTabsLoad=!1,a.searchFilter="",a.clientsData=[],a.isPagingCursor=a.isMoreClients=!1,a.selectedClientTab=0,a.getGroupData=function(b,c){var d=b,e=[];if(d.groups){angular.forEach(d.groups,function(b,c){var d=b;angular.forEach(a.groups,function(a,b){a.id==d&&e.push(a.name)})});var f="";angular.forEach(e,function(a,b){f+=e.length-1==b?a:a+", "}),b.groupsName=f}},a.getPagedDataAsync=function(b,c){a.isMsgGridShow=a.isClientsData=!1;var d={};d.status=b,d.filter=c,f.filterClientsData(d).then(function(b){0!==b.data.length?(a.isMsgGridShow=!1,a.isClientsData=!0,a.clientsData=b.data,angular.forEach(b.data,function(b,c){a.getGroupData(b,c)})):(a.isClientsData=!1,a.isMsgGridShow=!0),a.isClientsData&&!a.isMsgGridShow&&(a.isPagingCursor=!b.headers["x-paging-cursor"])},function(a){toastr.error("Failed retrieving clients data.","STATUS CODE: "+a.status)})},a.fnChangeStatus=function(b){a.getPagedDataAsync(b,a.searchFilter)},a.fnOpenNewClientSwap=function(){c(function(){a.rightView="",a.$apply(),a.rightView="views/authenticated/clients/newClient.html",a.$apply(),d("newClientView").open().then(function(){})})},a.fnNewClientView=function(){a.isClientEditable=!1,a.fnOpenNewClientSwap()},a.fnCloseNewClientSwap=function(){d("newClientView").close().then(function(){})},a.fnOpenClientManageSwap=function(){c(function(){a.rightEditView="",a.$apply(),a.rightEditView="views/authenticated/clients/manageClient.html",a.$apply(),d("manageClientSwap").open().then(function(){a.isTabsLoad=!0,"true"===CarglyPartner.user.verified&&"Super"===CarglyPartner.user.role&&(a.isSuperRole=!0)})})},a.fnCloseClientManageSwap=function(){d("manageClientSwap").close().then(function(){a.isTabsLoad=!1,f.setClientObj({})})},a.onSearchTextChanged=function(b){a.getPagedDataAsync(a.selectStatus,b)},a.fnCreateFilters=function(){a.selectStatusOptions=[{name:"Any Status",value:""},{name:"Disabled",value:"Disabled"},{name:"Active",value:"Active"},{name:"Need Payment Details",value:"NeedPaymentDetails"},{name:"Active Verify Subscriptions",value:"ActiveVerifySubscriptions"},{name:"Unconfirmed",value:"Unconfirmed"},{name:"Payment Errors",value:"PaymentErrors"}],g()},a.clientAction='<div layout="row"><md-button class="md-icon-button md-primary" ng-click="grid.appScope.fnClientEdit(row)">   <md-icon md-font-set="material-icons">visibility</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Open</md-tooltip></md-button></div>',a.clientsGridOptions={data:"clientsData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,columnDefs:[{field:"created",displayName:"Created Date",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:160,enableHiding:!1},{field:"partner",displayName:"Name",minWidth:200,enableHiding:!1},{field:"contactName",displayName:"Contact Name",minWidth:150,enableHiding:!1},{field:"groupsName",displayName:"Groups",minWidth:200,enableHiding:!1},{field:"subscriptionStatus",displayName:"Subscription Status",minWidth:100,enableHiding:!1},{name:"action",displayName:"",cellTemplate:a.clientAction,width:50,enableSorting:!1,enableColumnMenu:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},b.$on("RefreshClientsGrid",function(){a.getPagedDataAsync(a.selectStatus,a.searchFilter)}),a.fnClientEdit=function(b){a.editClientName=b.entity.partner,f.setClientObj(b.entity),a.fnOpenClientManageSwap()},a.fnLoadMoreClients=function(){a.isMoreClients=!0,f.fetchMoreClients().then(function(b){a.clientsData=a.clientsData.concat(b.data),a.isPagingCursor=!b.headers["x-paging-cursor"],a.isMoreClients=!1},function(a){toastr.error("Failed retrieving more clients data.","STATUS CODE: "+a.status)})},a.groups=[],a.fnFetchGroups=function(){e.fetchGroups().then(function(b){a.groups=b,a.fnCreateFilters()})},a.fnInitClients=function(){a.fnFetchGroups()}}]),app.controller("clientInfoCtrl",["$scope","$rootScope","toastr","globalTimeZone","clientService","clientUsersService",function(a,b,c,d,e,f){a.client=e.getClientObj().id?angular.copy(e.getClientObj()):{};var g=a.client.id;a.users=[],a.timeZoneDDOptions=[],a.contactDDOptions=[],a.selectedContact=a.client.contactId,a.isProcessing=!1,a.fnCreateContactDD=function(b){angular.forEach(b,function(b){a.contactDDOptions.push({contactName:b.name,contactId:b.id})})},a.fnFetchUsers=function(){a.contactDDOptions=[],f.fetchUsersByPartnerId(g).then(function(b){a.users=b,a.fnCreateContactDD(b)},function(a){c.error("Failed retrieving users.","STATUS CODE: "+a.status)})},a.fnChangeContactDD=function(b,c){if(c){var d=$.grep(a.users,function(a){return a.id===c})[0];d&&(b.contactId=d.id,b.contactName=d.name,b.contactEmail=d.email)}},a.fnSaveClientInfo=function(d){var f=angular.copy(d);delete f.groupsName;var h={};h.name=f.partner,h.timezone=f.timezone,h.contact_name=f.contactName,h.contact_email=f.contactEmail,h.contact_phone=f.contactPhone,h.contact_id=f.contactId,a.isProcessing=!0,e.updateClientInfo(g,h).then(function(d){null===d&&(b.$broadcast("RefreshClientsGrid"),c.success("Client information updated.")),a.isProcessing=!1},function(b){c.error("Failed saving information.","STATUS CODE: "+b.status),a.isProcessing=!1})},a.fnInitClientInfo=function(){a.timeZoneDDOptions=d,a.fnFetchUsers()}}]),app.controller("clientUsersCtrl",["$scope","$rootScope","$mdDialog","$mdSidenav","toastr","clientService","clientUsersService",function(a,b,c,d,e,f,g){a.client=f.getClientObj().id?angular.copy(f.getClientObj()):{};var h=a.client.id;b.isFetchLocations=!1,b.rightUserSwapView="views/authenticated/clients/clientUserManage.html",a.fnInitUsers=function(){a.getPagedDataAsync()},a.fnNewUserView=function(){b.editUserName="New User",g.setUserObj({}),a.fnOpenManageUser()},a.getPagedDataAsync=function(){a.isDataNotNull=!1,a.isMsgShow=!1,g.fetchUsersByPartnerId(h).then(function(b){0!==b.length?(a.isDataNotNull=!0,a.usersData=b):(a.isDataNotNull=!1,a.isMsgShow=!0)})},a.$on("RefreshUsersGrid",function(){a.getPagedDataAsync()}),a.userAction='<div layout="row"><md-button class="md-icon-button md-primary" ng-click="grid.appScope.fnUserEdit(row, $event);">   <md-icon md-font-set="material-icons">edit</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Edit</md-tooltip></md-button><md-button class="md-icon-button md-primary" ng-click="grid.appScope.fnResendConfirmation(row, $event);">   <md-icon md-font-set="material-icons">done_all</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Resend Confirmation</md-tooltip></md-button><md-button class="md-icon-button md-primary" ng-click="grid.appScope.fnResetPassword(row, $event);">   <md-icon md-font-set="material-icons">vpn_key</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Reset Password</md-tooltip></md-button><md-button class="md-icon-button md-primary" ng-click="grid.appScope.fnSendWelcomeEmail(row,$event);">   <md-icon md-font-set="material-icons">email</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Send Welcome Email</md-tooltip></md-button></div>',a.userGridOptions={data:"usersData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,columnDefs:[{field:"name",displayName:"Name",minWidth:200,enableHiding:!1},{field:"email",displayName:"Email",minWidth:200,enableHiding:!1},{field:"role",displayName:"Role",minWidth:100,enableHiding:!1},{field:"verified",displayName:"Verified",minWidth:100,enableHiding:!1},{name:"action",displayName:"",cellTemplate:a.userAction,width:200,enableSorting:!1,enableColumnMenu:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnSendWelcomeEmail=function(a){var b=c.confirm().title("Resend Welcome E-mail").content("Resending welcome email to your mail-id ?").ariaLabel("Ok").ok("Resend").cancel("Cancel");c.show(b).then(function(){g.sendWelcomeEmail(a.entity.email).then(function(){e.success("Welcome Email sent successfully.")})})},a.fnResendConfirmation=function(a,b){var d=c.confirm().title("Resend Confirmation").content("Resending confirmation to your email-id ?").ariaLabel("Ok").ok("Resend").cancel("Cancel").targetEvent(b);c.show(d).then(function(){g.reconfirm(a.entity.id).then(function(){e.success("Confirmation email sent successfully.")})})},a.fnResetPassword=function(a,b){var d=c.confirm().title("Reset Password Request").content("Resetting password to your email-id ?").ariaLabel("Ok").ok("Reset").cancel("Cancel").targetEvent(b);c.show(d).then(function(){g.requestPasswordReset(a.entity.email).then(function(){e.success("Password request sent successfully.")})})},a.fnUserEdit=function(c){a.intIndex=c.rowIndex,b.editUserName=c.entity.name,g.setUserObj(c.entity),a.fnOpenManageUser()},a.fnOpenManageUser=function(){b.isFetchLocations=!0,setTimeout(function(){b.rightUserSwapView="",a.$apply(),b.rightUserSwapView="views/authenticated/clients/clientUserManage.html",a.$apply(),d("manageUserSwap").open().then(function(){})})},b.fnCloseManageUser=function(){d("manageUserSwap").close().then(function(){b.isFetchLocations=!1})}}]),app.controller("newClientsCtrl",["$scope","$rootScope","toastr","globalTimeZone","clientService",function(a,b,c,d,e){a.client={timezone:"US/Central"},a.fnSaveClient=function(d){e.saveClient(d).then(function(d){c.success("Client save successfully."),a.client={timezone:"US/Central"},a.newClientForm.$setUntouched(),b.$broadcast("RefreshClientsGrid")},function(a){c.error("Can't be saved, repeated email or invalid information.","STATUS CODE: "+a.status)}),a.fnCloseNewClientSwap()},a.fnInitManageClient=function(){a.timeZoneDDOptions=d}}]),app.controller("clientUserManageCtrl",["$scope","$rootScope","toastr","clientService","clientUsersService","clientLocationService",function(a,b,c,d,e,f){a.client=d.getClientObj().id?d.getClientObj():{};var g=a.client.id;a.isProcessing=!1,a.user=e.getUserObj().id?angular.copy(e.getUserObj()):{role:"User",customerContact:void 0,owner:!1,verified:!1},a.locationDDOptions=[],a.fnIsCheckboxChecked=function(a){a.owner="true"===a.owner,a.verified="true"===a.verified},a.fnSaveUser=function(d){var f=d.id?d.id:null;a.isProcessing=!0,a.userForm.$invalid=!0,null===f?e.createUser(g,d).then(function(d){a.fnResetForm(),b.$broadcast("RefreshUsersGrid"),a.userForm.$invalid=!1,c.success("New User has been created."),b.fnCloseManageUser(),a.isProcessing=!1},function(b){c.error("User can't saved. Repeated email or invalid information."),a.isProcessing=!1}):e.updateUser(f,d).then(function(d){c.success("User saved successfully."),b.$broadcast("RefreshUsersGrid"),a.userForm.$invalid=a.isProcessing=!1,b.fnCloseManageUser()},function(b){c.error("User can't saved. Repeated email or invalid information."),a.isProcessing=!1})},a.fnResetForm=function(){a.user={role:"User",customerContact:!1,owner:!1,verified:!1},a.userForm.name.$touched=!1,a.userForm.email.$touched=!1,a.fnFetchLocations()},a.fnInitUser=function(){b.isFetchLocations&&a.fnFetchLocations(),a.fnIsCheckboxChecked(a.user)},a.fnFetchLocations=function(){g&&f.fetchLocations(g).then(function(b){b.length>0&&(a.locationDDOptions=b,a.user.id||(a.user.defaultLocation=b[0].id))},function(a){c.error("Cannot get location information.")})}}]),app.controller("clientLocationCtrl",["$scope","$rootScope","$mdSidenav","clientService","clientLocationService",function(a,b,c,d,e){a.client=d.getClientObj().id?d.getClientObj():{};var f=a.client.id;b.rightLocationSwapView="views/authenticated/clients/clientLocationManage.html",a.fnInitLocation=function(b){3===b&&a.getPagedDataAsync()},a.fnNewLocationView=function(){b.editLocName="New Location",e.setLocationObj({}),a.fnOpenManageLoc()},a.getPagedDataAsync=function(){a.isDataNotNull=!1,a.isMsgShow=!1,e.fetchLocations(f).then(function(b){0!==b.length?(a.isDataNotNull=!0,a.isMsgShow=!1,a.locationData=b):(a.isDataNotNull=!1,a.isMsgShow=!0)})},a.$on("ClientLocationListener",function(){a.getPagedDataAsync()}),a.colorIndicator='<div class="checked_item after-status" location-indicator data-obj="row.entity"></div>',a.locationAction='<div layout="row"><md-button class="md-icon-button md-primary" ng-click="grid.appScope.fnLocationEdit(row,$event)">   <md-icon md-font-set="material-icons">edit</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Edit</md-tooltip></md-button></div>',a.locationGridOptions={data:"locationData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,columnDefs:[{name:"colorIndicator",displayName:"",cellTemplate:a.colorIndicator,width:50,enableSorting:!1,enableColumnMenu:!1},{field:"name",displayName:"Name",minWidth:200,enableHiding:!1},{field:"address",displayName:"Address",minWidth:200,enableHiding:!1},{field:"city",displayName:"City",minWidth:100,enableHiding:!1},{field:"state",displayName:"State",minWidth:90,enableHiding:!1},{field:"zip",displayName:"Zip",minWidth:100,enableHiding:!1},{name:"action",displayName:"",cellTemplate:a.locationAction,width:50,enableSorting:!1,enableColumnMenu:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnLocationEdit=function(c){a.intIndex=c.rowIndex,b.editLocName=c.entity.name,e.setLocationObj(c.entity),a.fnOpenManageLoc()},a.fnOpenManageLoc=function(){setTimeout(function(){b.rightLocationSwapView="",a.$apply(),b.rightLocationSwapView="views/authenticated/clients/clientLocationManage.html",a.$apply(),c("manageLocSwap").open().then(function(){})})},b.fnCloseManageLoc=function(){c("manageLocSwap").close().then(function(){})}}]),app.controller("clientLocationManageCtrl",["$scope","$rootScope","toastr","globalTimeZone","clientService","clientLocationService",function(a,b,c,d,e,f){a.client=e.getClientObj().id?e.getClientObj():{};var g=a.client.id;a.isProcessing=!1,a.location=f.getLocationObj().id?angular.copy(f.getLocationObj()):{timezone:"US/Central"},a.fnSaveLocation=function(d){var e=d.id?d.id:null;a.isProcessing=!0,a.locationForm.$invalid=!0,null===e?f.createLocation(g,d).then(function(d){d.location_id&&(a.fnResetForm(),b.$broadcast("ClientLocationListener"),b.fnCloseManageLoc(),a.isProcessing=!1,a.locationForm.$invalid=!1,c.success("New Location has been created.")),b.fnCloseManageLoc()}):f.updateLocation(e,d).then(function(d){null===d&&(b.$broadcast("ClientLocationListener"),a.isProcessing=!1,a.locationForm.$invalid=!1,c.success("Location saved successfully.")),b.fnCloseManageLoc()})},a.fnResetForm=function(){a.location={timezone:"US/Central"},a.locationForm.name.$touched=!1,a.locationForm.phone.$touched=!1,a.locationForm.address.$touched=!1,a.locationForm.city.$touched=!1,a.locationForm.state.$touched=!1,a.locationForm.zip.$touched=!1},a.fnInitClientLocationManage=function(){a.timeZoneDDOptions=d}}]),app.controller("clientBillingCtrl",["$scope","$mdDialog","$rootScope","$filter","toastr","clientService","clientBillingServices","subscriptionService","clientLocationService",function(a,b,c,d,e,f,g,h,i){function j(a){return d("date")(a,"M/d/yyyy h:mm a")}a.client=f.getClientObj().id?f.getClientObj():{};var k=a.client.id;a.isSubscriptionDefLoaded=!1,a.fnCreateSubDD=function(){a.selectStatusOptions=[{name:"Disabled",value:"Disabled"},{name:"Active",value:"Active"},{name:"Need Payment Details",value:"NeedPaymentDetails"},{name:"Active Verify Subscriptions",value:"ActiveVerifySubscriptions"},{name:"Unconfirmed",value:"Unconfirmed"},{name:"Payment Errors",value:"PaymentErrors"}],a.client.subscriptionStatus||(a.subscriptionInfo.subscription_status=a.selectStatusOptions[0].value)},a.paymentInfo={},a.fnClientBillingInit=function(){a.fnCreateSubDD(),a.fnGetClientPaymentInfo(),a.fnFetchClientSubscriptionInfo(),a.fnFetchSubscription()},a.fnGetClientPaymentInfo=function(){g.fetchClientPaymentInfo(k).then(function(b){a.paymentInfo=b,a.paymentExpiration=b.exp_month&&b.exp_year?b.exp_month+"/"+b.exp_year:""})},a.fnFetchClientSubscriptionInfo=function(){g.fetchClientSubscriptionInfo(k).then(function(b){b.last_payment=j(b.last_payment),b.next_payment_due=j(b.next_payment_due),b.subscription_total=d("currency")(d("CentToDollar")(b.subscription_total)),b.balance_cents=b.balance_cents/100,b.receipt_emails=b.receipt_emails.join(),b.locations||(b.locations=[]),a.subscriptionInfo=b,a.fnFetchLocations()})},c.$on("getUpdatedPaymentInfo",function(){a.fnGetClientPaymentInfo()}),c.$on("ClientLocationListener",function(){a.fnFetchLocations()}),a.fnOpenClientPaymentInfo=function(c){var d=["$scope","$rootScope",function(a,c){function d(d){g.updateClientPaymentInfo(k,d).then(function(d){d&&500===d.status?e.error("Payment information saving failed."):(e.success("Payment information saved."),c.$broadcast("getUpdatedPaymentInfo"),c.$broadcast("evBillingHistoryGrid")),b.hide(),a.isProcessing=!1})}ChargeIO.init({publicKey:CarglyPartner.user.paymentProcessingPublicKey}),a.isProcessing=!1,a.updateUserPaymentInfo=function(){a.isProcessing=!0,ChargeIO.create_token(a.paymentInfo,d,function(a){console.log(a.error.message),e.error("Charge IO create token failed.")})},a.fnCancel=function(){b.cancel()}}];b.show({controller:d,templateUrl:"views/authenticated/clients/modals/updatePaymentInfo.html",targetEvent:c}),a.isProcessing=!1},a.fnOpenClientChargeNow=function(a){var c=["$scope","$rootScope",function(a,c){a.invoice={amount:"",description:"",reference:""},a.isProcessing=!1,a.fnSaveInvoice=function(d){var f=angular.copy(d);f.amount=100*f.amount,a.isProcessing=!0,g.saveInvoice(k,f).then(function(d){d&&500===d.status?e.error("Customer Bill information saving failed."):(e.success("Customer Bill information saved."),c.$broadcast("evBillingHistoryGrid")),a.isProcessing=!1,b.hide()})},a.fnCancel=function(){b.cancel()}}];b.show({controller:c,templateUrl:"views/authenticated/clients/modals/chargeNow.html",targetEvent:a})},a.isProcessing=!1,a.isSubInfoBtnDisabled=!1,a.checkboxes=[],a.subTotal={},a.grandTotal=0,a.subArr={},a.fnInitLocation=function(b,c){if(a.subTotal[b]=0,c){var d=$.grep(c,function(a){return a.id===b})[0];d&&(a.subArr[b]=d.subscriptions)}},a.isSelected={},a.fnFetchSubscription=function(){a.grandTotal=0,h.fetchSubscriptions().then(function(b){a.checkboxes=b.subscription_definitions})},a.fnFetchLocations=function(){a.isSubscriptionDefLoaded=!1,i.fetchLocations(k).then(function(b){a.locations=b,a.isSubscriptionDefLoaded=!0})},a.fnInitCheckbox=function(b,c,d,e,f){angular.forEach(c,function(c){c===b&&(a.isSelected[d]=!0,a.subTotal[e]=a.subTotal[e]+f,a.grandTotal=a.grandTotal+f)})},a.fnCheckboxChange=function(b,c,d,e,f){var g=$.grep(b,function(a){return a.id===d})[0];if(g)if(c===!0)g.subscriptions.push(e),a.subTotal[d]=a.subTotal[d]+f,a.grandTotal=a.grandTotal+f;else{var h=g.subscriptions.indexOf(e);h>-1&&g.subscriptions.splice(h,1),a.subTotal[d]=a.subTotal[d]-f,a.grandTotal=a.grandTotal-f}else c===!0&&(b.push({id:d,subscriptions:[e]}),a.subTotal[d]=a.subTotal[d]+f,a.grandTotal=a.grandTotal+f)},a.openDatePicker=function(a,c){var d=["$scope","$mdDialog",function(a,b){a.displayMode="full",a.dateValue=c.next_payment_due?c.next_payment_due:new Date,a.fnSave=function(b){c.next_payment_due=j(b),a.hide()},a.fnCancel=function(){a.hide()},a.hide=function(){b.hide()}}];b.show({controller:d,templateUrl:"views/authenticated/clients/modals/datePickerDialog.html",targetEvent:a})},a.fnRemoveLocFromSub=function(a,b){angular.forEach(b,function(c,d){var e=$.grep(a,function(a){return a.id===c.id})[0];e||b.splice(d,1)})},a.fnSaveSubscriptionInfo=function(b,d){a.fnRemoveLocFromSub(a.locations,b.locations);var f=angular.copy(b);delete f.last_payment,delete f.subscription_total,f.balance_cents=100*f.balance_cents,null!==f.next_payment_due&&""!==f.next_payment_due&&(f.next_payment_due=new Date(f.next_payment_due).toISOString()),f.subscription_total=angular.copy(d),f.receipt_emails=f.receipt_emails.split(","),a.isProcessing=!0,a.isSubInfoBtnDisabled=!0,g.saveClientSubscriptionInfo(k,f).then(function(b){b.status||(e.success("Subscription information saved."),a.fnFetchClientSubscriptionInfo(),a.grandTotal=0,c.$broadcast("RefreshClientsGrid")),a.isProcessing=!1,a.isSubInfoBtnDisabled=!1})}}]),app.controller("clientBillingHistoryCtrl",["$scope","$rootScope","$mdDialog","clientService","clientBillingServices",function(a,b,c,d,e){a.client=d.getClientObj().id?angular.copy(d.getClientObj()):{};
var f=a.client.id;a.fnInitBillingHistory=function(){a.getPagedDataAsync()},b.$on("evBillingHistoryGrid",function(){a.getPagedDataAsync()}),a.getPagedDataAsync=function(){a.isDataNotNull=!1,a.isMsg=!1,e.fetchClientPayments(f).then(function(b){b.length>0?(a.isDataNotNull=!0,angular.forEach(b,function(a){a.details=a.details?JSON.parse(a.details):a.details}),a.billingHistoryData=b):(a.isDataNotNull=!0,a.isMsg=!0),a.isProcessing=!1})},a.isPaid=function(a){return"PAID"===a.entity.status},a.isProcessing=!1,a.errorTooltip='<div layout="row" class="ui-grid-cell-contents"><div ng-show="{{row.entity.details.messages[0]}}">    <md-button class="md-icon-button md-warn">       <md-icon md-font-set="material-icons">highlight_off</md-icon>       <md-tooltip ng-if="$root.isMobile === null" md-direction="top">{{row.entity.details.messages[0].message}}</md-tooltip>   </md-button></div>{{row.entity.status}}</div>',a.billingHistoryAction='<div layout="row"><md-button ng-if="grid.appScope.isPaid(row)" ng-disabled="grid.appScope.isProcessing" class="md-icon-button md-primary" ng-click="grid.appScope.fnRefund(row,$event)">   <md-icon md-font-set="material-icons">payment</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Refund</md-tooltip></md-button> </div>',a.billingHistoryGridOptions={data:"billingHistoryData",rowHeight:50,enablePaging:!1,multiSelect:!1,enableVerticalScrollbar:0,enableRowSelection:!0,enableRowHeaderSelection:!1,columnDefs:[{field:"date",displayName:"Date",minWidth:150,cellFilter:"date:'MM/dd/yyyy h:mm a'",enableHiding:!1},{field:"reference",displayName:"Invoice #",minWidth:100,enableHiding:!1},{field:"description",displayName:"Description",minWidth:250,enableHiding:!1},{field:"status",displayName:"Status",minWidth:150,cellTemplate:a.errorTooltip,enableHiding:!1},{field:"amount",displayName:"Amount",cellFilter:"CentToDollar | currency",minWidth:100,enableHiding:!1},{name:"action",displayName:"",cellTemplate:a.billingHistoryAction,width:50,enableSorting:!1,enableColumnMenu:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnRefund=function(b,d){var g=c.confirm().title("Refund").content("Are you sure you want to perform this refund?").ariaLabel("Ok").ok("Refund").cancel("Cancel").targetEvent(d);c.show(g).then(function(){a.isProcessing=!0,e.refundPayment(f,b.entity.id).then(function(){a.getPagedDataAsync()})})}}]),app.controller("clientUpdatesCtrl",["$scope","$mdSidenav","$rootScope","pagingOptions","$mdDialog","updateService","clientService","clientLocationService","shopLocationsService",function(a,b,c,d,e,f,g,h,i){a.client=g.getClientObj().id?angular.copy(g.getClientObj()):{};var j=a.client.id;c.rightUpdateSwapView="views/authenticated/clients/clientUpdateManage.html",a.updatesDefinitions=[],c.isFetchUpdateDefinitions=!1,a.intLocIndex=0,a.fnNewUpdateView=function(){c.updateHeading="New Update",a.fnOpenManageUpdate()},a.pagingOptions=d,a.paginationOptions={pageNumber:1,pageSize:5},a.fnInitUpdates=function(){a.fnFetchLocations(),a.fnFetchUpdatesDefinitions()},a.selectType="",a.fnFetchUpdatesDefinitions=function(){f.fetchUpdatesDefinitions().then(function(b){a.updatesDefinitions=b,a.updatesDefinitions.unshift({type:"All Update Types"}),a.selectType="All Update Types"})},a.fnUpdatesDefinitionsDDChange=function(b){a.selectType=b,"All Update Types"===b?a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber):a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber,b)},a.fnFetchLocations=function(){h.fetchLocations(j).then(function(b){a.locations=b,a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber)})},a.fnTextBoxKeyEvent=function(b){a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber,b)},a.setLocationData=function(b){angular.forEach(b,function(b){var c=$.grep(a.locations,function(a){return a.id===b.location_id})[0];c?b.location_name=c.name:b.location_name="All locations"}),a.clientUpdatesData=b},a.getPagedDataAsync=function(b,c,d){var e=/^\d+$/;e.test(c)&&(b||c||d)&&(a.isDataNotNull=!1,a.isMsgShow=!1,f.fetchUpdates(j,d,c,b).then(function(b){a.isDataNotNull=!0,0!==b.updates.length?(a.isDataNotNull=!0,a.isMsgShow=!1):(a.isDataNotNull=!1,a.isMsgShow=!0),a.setLocationData(b.updates)}))},a.$on("refreshUpdates",function(){a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber)}),a.fnUpdatesPageSizeChange=function(b){b.pageNumber=1,"All Update Types"===a.selectType?a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber):a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber,a.selectType)},a.fnPreviousPage=function(){a.paginationOptions.pageNumber--,"All Update Types"===a.selectType?a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber):a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber,a.selectType)},a.fnNextPage=function(){a.paginationOptions.pageNumber++,"All Update Types"===a.selectType?a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber):a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber,a.selectType)},a.updateAction='<div layout="row"><md-button class="md-icon-button md-warn" ng-click="grid.appScope.fnUpdateDelete(row,$event)">   <md-icon md-font-set="material-icons">delete</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Delete</md-tooltip></md-button></div>',a.updateGridOptions={data:"clientUpdatesData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enablePaginationControls:!1,enableVerticalScrollbar:0,columnDefs:[{field:"location_name",displayName:"Location",minWidth:180,enableHiding:!1},{field:"created",displayName:"Created",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:180,enableHiding:!1},{field:"update_type",displayName:"Type",minWidth:100,enableHiding:!1},{field:"update_url",displayName:"URL",minWidth:180,enableHiding:!1},{field:"signature",displayName:"Signature",minWidth:100,enableHiding:!1},{field:"version",displayName:"Version",minWidth:80,enableHiding:!1},{name:"action",displayName:"",cellTemplate:a.updateAction,width:50,enableSorting:!1,enableColumnMenu:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnUpdateDelete=function(b,c){var d=e.confirm().title("Delete").content("Would you like to delete this update?").ariaLabel("Delete").ok("Delete").cancel("Cancel").targetEvent(c);e.show(d).then(function(){f.deleteUpdate(j,b.entity.id).then(function(){a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber)})})},a.fnOpenManageUpdate=function(){c.isFetchUpdateDefinitions=!0,setTimeout(function(){c.rightUpdateSwapView="",a.$apply(),c.rightUpdateSwapView="views/authenticated/clients/clientUpdateManage.html",a.$apply(),b("manageUpdateSwap").open().then(function(){})})},c.fnCloseManageUpdate=function(){b("manageUpdateSwap").close().then(function(){c.isFetchUpdateDefinitions=!1})},a.fnRunUpdate=function(b){i.fetchNextConfig(a.locations[b].id).then(function(c){"yes"!==c.run_update?(c.run_update="yes",i.saveNextConfig(a.locations[b].id,c).then(function(){a.intLocIndex-=1})):a.intLocIndex-=1})},a.$watch("intLocIndex",function(b){0!==b&&a.fnRunUpdate(b-1)}),a.fnRunUpdateNow=function(b){var c=e.confirm().title("Run Update Now").content("Are you sure you want to run an update now?").ok("Run").ariaLabel("Ok").cancel("Cancel").targetEvent(b);e.show(c).then(function(){a.intLocIndex=a.locations.length},function(){})}}]),app.controller("clientUpdateManageCtrl",["$scope","$rootScope","toastr","updateService","clientService","clientLocationService",function(a,b,c,d,e,f){function g(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}a.client=e.getClientObj().id?angular.copy(e.getClientObj()):{};var h=a.client.id;a.isProcessing=!1,a.updatesDefinitions=[],a.update={},a.locationsDD=[{id:"NONE",name:"All locations"}],a.update.location_id="NONE",a.fnInitUpdateManage=function(){b.isFetchUpdateDefinitions&&a.fnFetchUpdatesDefinitions(),a.fnFetchLocations()},a.fnFetchUpdatesDefinitions=function(){d.fetchUpdatesDefinitions().then(function(b){a.updatesDefinitions=b,a.updatesDefinitionObj=b[0],a.isAppliesToLocation=!!b[0].applies_to_location})},a.fnUpdatesDefinitionsDDChange=function(b){a.isAppliesToLocation=!!b.applies_to_location},a.fnFetchLocations=function(){f.fetchLocations(h).then(function(b){angular.forEach(b,function(b){a.locationsDD.push({id:b.id,name:b.name})})})},a.fnSaveUpdate=function(e){var f=angular.copy(e);a.isProcessing=a.updateForm.$invalid=!0,"NONE"===f.location_id&&delete f.location_id,d.createUpdate(h,f).then(function(d){if(g(d)||d.status){if(d.data){var e=JSON.parse(d.data);if(g(e))c.error("Update not saved");else{var f=e.messages[0].message;c.error(f)}}}else c.success("Update saved successfully."),b.$broadcast("refreshUpdates");a.isProcessing=a.updateForm.$invalid=!1,b.fnCloseManageUpdate()})},a.fnResetForm=function(){a.update={},a.updateForm.$setUntouched()}}]),app.controller("clientUpdateStatusesCtrl",["$scope","$mdDialog","clientService","clientLocationService","updateService","pagingOptions",function(a,b,c,d,e,f){a.client=c.getClientObj().id?angular.copy(c.getClientObj()):{};var g=a.client.id;a.pagingOptions=f,a.paginationOptions={pageNumber:1,pageSize:5},a.hide=function(){b.hide()},a.fnInitUpdateStatuses=function(){a.fnFetchLocations(),a.fnFetchUpdatesDefinitions()},a.selectType="",a.fnFetchUpdatesDefinitions=function(){e.fetchUpdatesDefinitions().then(function(b){a.updatesDefinitions=b,a.updatesDefinitions.unshift({type:"All Update Types"}),a.selectType="All Update Types"})},a.fnUpdatesDefinitionsDDChange=function(b){a.selectType=b,"All Update Types"===b?a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber):a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber,b)},a.fnFetchLocations=function(){d.fetchLocations(g).then(function(b){a.locations=b,a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber)})},a.fnTextBoxKeyEvent=function(b){a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber,b)},a.setPagingData=function(b){angular.forEach(b,function(b){var c=$.grep(a.locations,function(a){return a.id===b.location_id})[0];c?b.location_name=c.name:b.location_name="All locations"}),a.clientUpdateStatusesData=b},a.getPagedDataAsync=function(b,c,d){var f=/^\d+$/;f.test(c)&&(b||c||d)&&(a.isDataNotNull=!1,a.isMsgShow=!1,e.fetchUpdateStatuses(g,d,c,b).then(function(b){a.isDataNotNull=!0,0!==b.length?(a.isDataNotNull=!0,a.isMsgShow=!1):(a.isDataNotNull=!1,a.isMsgShow=!0),a.setPagingData(b)}))},a.fnUpdatesPageSizeChange=function(b){b.pageNumber=1,"All Update Types"===a.selectType?a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber):a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber,a.selectType)},a.fnPreviousPage=function(){a.paginationOptions.pageNumber--,"All Update Types"===a.selectType?a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber):a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber,a.selectType)},a.fnNextPage=function(){a.paginationOptions.pageNumber++,"All Update Types"===a.selectType?a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber):a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber,a.selectType)},a.updateStatusesGridOptions={data:"clientUpdateStatusesData",rowHeight:50,multiSelect:!1,enableVerticalScrollbar:0,enableRowSelection:!0,enableRowHeaderSelection:!1,enablePaginationControls:!1,enableGridMenu:!0,columnDefs:[{field:"location_name",displayName:"Location",minWidth:180},{name:"Created",field:"created",displayName:"Created",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:180},{field:"update_type",displayName:"Type",minWidth:100},{field:"update_url",displayName:"URL",minWidth:200},{field:"update_version",displayName:"Update Version",minWidth:150},{field:"prior_version",displayName:"Prior Version",minWidth:150},{field:"status",displayName:"Status",minWidth:150},{field:"details",displayName:"Details",visible:!1,minWidth:200}],onRegisterApi:function(b){a.gridApi=b,b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}}}]),app.controller("clientEmailsCtrl",["$scope","$rootScope","$mdSidenav","$timeout","toastr","clientService","clientEmailService",function(a,b,c,d,e,f,g){a.client=f.getClientObj().id?angular.copy(f.getClientObj()):{};var h=a.client.id;a.isEmailsDataNotNull=a.isEmailsMsgShow=a.isMoreEmailData=!1,a.isPagingData=!0,a.clientEmailsData={},a.pagingOptions={page_num:1,page_size:20},a.getPagedDataAsync=function(){a.isEmailsDataNotNull=a.isEmailsMsgShow=!1,g.fetchClientEmails(h,a.pagingOptions).then(function(b){0!==b.length?(a.isEmailsDataNotNull=!0,a.isEmailsMsgShow=!1,a.clientEmailsData=b):(a.isEmailsDataNotNull=!1,a.isEmailsMsgShow=!0)},function(b){401!==b.status&&500!==b.status&&e.error("Something goe's wrong, getting emails data."),a.isEmailsMsgShow=!0,a.isEmailsDataNotNull=!1})},a.clientEmailAction='<div class="ui-grid-cell-contents padding-left-0">   <md-button class="md-icon-button md-primary" ng-click="grid.appScope.fnViewEmailClient(row)">   <md-icon md-font-set="material-icons">visibility</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">View</md-tooltip></md-button></div>',a.clientEmailsGridOptions={data:"clientEmailsData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,columnDefs:[{field:"sent",displayName:"Sent",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:200,enableHiding:!1},{field:"location_name",displayName:"Location",minWidth:200,enableHiding:!1},{field:"to_email",displayName:"Email",minWidth:200,enableHiding:!1},{field:"state",displayName:"Status",minWidth:100,enableHiding:!1},{field:"last_event",displayName:"Modified",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:200,enableHiding:!1},{name:"action",displayName:"",cellTemplate:a.clientEmailAction,width:"50",enableSorting:!1,enableColumnMenu:!1}]},a.fnOpenManageEmailClient=function(){d(function(){b.rightClientEmailSwapView="",a.$apply(),b.rightClientEmailSwapView="views/authenticated/clients/clientEmailManage.html",a.$apply(),c("manageClientEmailSwap").open().then(function(){})})},a.fnViewEmailClient=function(c){b.locationName=c.entity.location_name,g.setClientEmailObj(c.entity),a.fnOpenManageEmailClient()},b.fnCloseClientEmailSwap=function(){c("manageClientEmailSwap").close().then(function(){g.setClientEmailObj({})})},a.fnShowMoreEmails=function(){a.pagingOptions.page_num+=1,a.isMoreEmailData=!0,a.isPagingData=!0,g.fetchClientEmails(h,a.pagingOptions).then(function(b){0!==b.length?(a.clientEmailsData=a.clientEmailsData.concat(b),a.isMoreEmailData=!1):a.isPagingData=!1},function(a){401!==a.status&&500!==a.status&&e.error("Something goe's wrong, getting emails data.")})},a.fnInitEmails=function(){a.getPagedDataAsync()},b.rightClientEmailSwapView="views/authenticated/clients/clientEmailManage.html"}]),app.controller("clientEmailManageCtrl",["$scope","clientEmailService",function(a,b){a.clientEmailData=b.getClientEmailObj();var c=angular.element("#clientHtmlEmailTemplate")[0];c&&""!==c&&(c.src="about:blank",c.contentWindow.document.open("text/htmlreplace"),c.contentWindow.document.write(a.clientEmailData.html),c.contentWindow.document.close(),c.contentWindow.document.onmousedown=function(){return!1})}]),app.controller("paymentsCtrl",["$scope","$rootScope","$mdDialog","$mdSidenav","clientService","clientPaymentsServices","clientBillingServices","toastr",function(a,b,c,d,e,f,g,h){a.rightEditView="views/authenticated/clients/manageClient.html",a.isTabsLoad=!1,a.groups=[],a.clients=[],a.isPaymentFailed=!1,a.fnInitPayments=function(){a.fnFetchClientPayments()},a.fnFetchClients=function(){e.fetchClients().then(function(b){a.clients=b})},a.fnFetchClientPayments=function(){setTimeout(function(){a.isDataNotNull=!1,a.isMsg=!1,f.fetchClientPayments().then(function(b){b.length>0?(a.isDataNotNull=!0,a.isMsg=!1,angular.forEach(b,function(a){a.status=a.status?a.status:"FAILED",a.details=a.details?JSON.parse(a.details):a.details}),a.paymentsData=b):(a.isDataNotNull=!1,a.isMsg=!0)})},100)},a.isPaid=function(a){return"PAID"===a.entity.status},a.isProcessing=!1,a.error_tooltip='<div layout="row" class="ui-grid-cell-contents"><div ng-show="{{row.entity.details.messages[0]}}">    <md-button class="md-icon-button md-warn">       <md-icon md-font-set="material-icons">highlight_off</md-icon>       <md-tooltip ng-if="$root.isMobile === null" md-direction="top">{{row.entity.details.messages[0].message}}</md-tooltip>   </md-button></div>{{row.entity.status}}</div>',a.paymentsAction='<div layout="row"><md-button class="md-icon-button md-primary"            ng-click="grid.appScope.fnOpenClientPaymentPage(row,$event,grid.appScope.clients);"            ng-init="grid.appScope.fnOpenClientBtnInit();">   <md-icon md-font-set="material-icons">visibility</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Open Client</md-tooltip></md-button><md-button class="md-icon-button md-primary" ng-if="grid.appScope.isPaid(row)"            ng-disabled="grid.appScope.isProcessing"            ng-click="grid.appScope.fnRefund(row,$event);">   <md-icon md-font-set="material-icons">payment</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Refund</md-tooltip></md-button></div>',a.paymentsGridOptions={data:"paymentsData",rowHeight:50,multiSelect:!1,enableVerticalScrollbar:0,enableRowSelection:!0,enableRowHeaderSelection:!1,columnDefs:[{field:"client_name",displayName:"Name",enableHiding:!1,minWidth:200},{field:"date",displayName:"Date",minWidth:180,enableHiding:!1,cellFilter:"date:'MM/dd/yyyy h:mm a'"},{field:"invoice_num",displayName:"Invoice #",enableHiding:!1,minWidth:100},{field:"description",displayName:"Description",enableHiding:!1,minWidth:200},{name:"status",displayName:"Status",cellTemplate:a.error_tooltip,minWidth:150,enableHiding:!1},{field:"amount_cents",displayName:"Amount",enableHiding:!1,cellFilter:"CentToDollar | currency",minWidth:120},{name:"action",displayName:"",cellTemplate:a.paymentsAction,width:100,enableSorting:!1,enableColumnMenu:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnRefund=function(b,d){var e=c.confirm().title("Refund").content("Are you sure you want to perform this refund?").ariaLabel("Ok").ok("Refund").cancel("Cancel").targetEvent(d);c.show(e).then(function(){a.isProcessing=!0,g.refundPayment(b.entity.client_id,b.entity.id).then(function(){a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage)})})},a.fnOpenClientBtnInit=function(){a.isPaymentFailed||(a.fnFetchClients(),a.isPaymentFailed=!0)},a.fnOpenClientPaymentPage=function(b,c,d){a.intIndex=b.rowIndex,a.editClientName=b.entity.client_name,a.isTabsLoad=!0;var f={};return(f=$.grep(d,function(a){return a.id===b.entity.client_id})[0])?(e.setClientObj(f),void a.fnOpenClientManageSwap()):void h.error("The client id could not be found.")},a.fnOpenClientManageSwap=function(){setTimeout(function(){a.rightEditView="",a.$apply(),a.rightEditView="views/authenticated/clients/manageClient.html",a.$apply(),d("manageClientSwap").open().then(function(){})})},a.fnCloseClientManageSwap=function(){d("manageClientSwap").close().then(function(){})},a.selectedTab=0,a.fnGetSelectedTabVal=function(b){a.$broadcast("SwitchTab",{tabIndex:b})},b.rightUserSwapView="views/authenticated/clients/clientUserManage.html",b.rightLocationSwapView="views/authenticated/clients/clientLocationManage.html"}]),app.controller("groupsCtrl",["$scope","$mdSidenav","$rootScope","$mdDialog","groupService",function(a,b,c,d,e){a.rightView="views/authenticated/shopGroups/manageGroup.html",a.isGroupEditable=!1,a.$on("RefreshGroupsGrid",function(){a.fnFetchGroups()}),a.fnFetchGroups=function(){e.fetchGroups().then(function(b){0!==b.length?(a.isGroupsData=!0,a.isMsgGridShow=!1,a.groupsData=b):(a.isGroupsData=!1,a.isMsgGridShow=!0)})},a.groupsAction='<div layout="row"><md-button class="md-icon-button md-primary" ng-click="grid.appScope.fnGroupEdit(row,$event)">   <md-icon md-font-set="material-icons">edit</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Edit</md-tooltip></md-button><md-button class="md-icon-button md-warn" ng-click="grid.appScope.fnGroupDelete(row,$event)">   <md-icon md-font-set="material-icons">delete</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Delete</md-tooltip></md-button></div>',a.groupsGridOptions={data:"groupsData",rowHeight:50,multiSelect:!1,enableVerticalScrollbar:0,enableRowSelection:!0,enableRowHeaderSelection:!1,columnDefs:[{field:"name",displayName:"Group Name",enableHiding:!1},{name:"action",displayName:"",cellTemplate:a.groupsAction,width:100,enableSorting:!1,enableColumnMenu:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnGroupDelete=function(b,c){var f=d.confirm().title("Delete").content("Would you like to delete this group?").ariaLabel("Delete").ok("Delete").cancel("Cancel").targetEvent(c);d.show(f).then(function(){e.deleteGroup(b.entity.id).then(function(){a.fnFetchGroups()})})},a.fnGroupEdit=function(b){a.intIndex=b.rowIndex,a.editGroupName=b.entity.name,e.setGroupObj(b.entity),a.fnOpenManageGroupSwap(!0)},a.fnOpenManageGroupSwap=function(c){a.isGroupEditable=c,setTimeout(function(){a.rightView="",a.$apply(),a.rightView="views/authenticated/shopGroups/manageGroup.html",a.$apply(),b("manageGroupView").open().then(function(){a.isTabsLoad=!0})})},a.fnCloseManageGroupSwap=function(){b("manageGroupView").close().then(function(){})},a.fnInitGroups=function(){a.fnFetchGroups()}}]),app.controller("manageGroupCtrl",["$scope","$rootScope","toastr","groupService","$mdDialog","$q",function(a,b,c,d,e,f){var g="";a.isAddBtnDisabled=!0,a.isGroupMembersLoad=!1,a.partnerId="",a.selectedGroupsTab=0,a.autoComplete={},a.isProcessing=!1,a.searchTextChange=function(b){a.isAddBtnDisabled=!0},a.initMember=function(b){var c=f.defer();return d.fetchClientsUsingFilter(b).then(function(b){var d=[];angular.forEach(b,function(a){d.push({label:a.partner,id:a.id})}),a.members=d,c.resolve(a.members)}),c.promise},a.selectedItemChange=function(b){b?(a.isAddBtnDisabled=!1,a.partnerId=b.id):a.isAddBtnDisabled=!0},a.fnManageGroupInit=function(){d.getGroupObj().id?(g=d.getGroupObj().id,a.group=angular.copy(d.getGroupObj()),a.fnFetchClients(a.group)):a.group={name:""}},a.fnFetchClients=function(b){d.fetchClients().then(function(c){b&&a.fetchGroupMembers(b,c)})},a.fnSaveGroup=function(b){a.isProcessing=!0,b.id?d.editGroup(b.id,b).then(function(b){c.success("Group saved successfully."),a.fnGroupToastMsg(b),a.fnCloseManageGroupSwap(),a.isProcessing=!1},function(b){c.error("Failed saving group information.","STATUS CODE: "+b.status),a.isProcessing=!1}):d.createGroup(b).then(function(b){c.success("Group created successfully."),a.fnGroupToastMsg(b),a.fnCloseManageGroupSwap(),a.isProcessing=!1},function(b){c.error("Failed creating group.","STATUS CODE: "+b.status),a.isProcessing=!1})},a.fnAddMemberToGroup=function(e){g&&d.addMemberPartnerToGroup(g,e).then(function(d){a.fnFetchClients(d),b.$broadcast("RefreshGroupsGrid"),c.success("Location added to membership list.")},function(){c.error("Something goe's wrong while adding membership list.")}),a.isAddBtnDisabled=!0},a.fnGroupToastMsg=function(a){if(a.data){var d=JSON.parse(a.data);c.error(d.messages[0].message)}else b.$broadcast("RefreshGroupsGrid")},a.fetchGroupMembers=function(b){a.isGroupMembersLoad=!1,d.fetchGroupMembers(b.id).then(function(b){a.isGroupMembersLoad=!0,a.fnGenerateGroupMemberGrid(b)})},a.fnGenerateGroupMemberGrid=function(c){a.groupsMembersData=c,a.groupMembersAction='<div layout="row"><md-button class="md-icon-button md-warn"            ng-click="grid.appScope.fnGroupMemberDelete(row,$event)">   <md-icon md-font-set="material-icons">delete</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Delete</md-tooltip></md-button></div>',a.groupMembersGridOptions={data:"groupsMembersData",rowHeight:50,multiSelect:!1,enableVerticalScrollbar:0,enableRowSelection:!0,enableRowHeaderSelection:!1,columnDefs:[{field:"partner",displayName:"Member Name",enableHiding:!1},{name:"action",displayName:"",cellTemplate:a.groupMembersAction,width:50,enableSorting:!1,enableColumnMenu:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnGroupMemberDelete=function(c,f){var h=e.confirm().title("Delete").content("Would you like to delete this member from group?").ariaLabel("Delete").ok("Delete").cancel("Cancel").targetEvent(f);e.show(h).then(function(){d.deleteMemberPartnerFromGroup(g,c.entity.id).then(function(c){a.fnFetchClients(c),b.$broadcast("RefreshGroupsGrid")})})}}}]),app.controller("shopLocationsCtrl",["$scope","$mdSidenav","toastr","$rootScope","$cookies","$state","$mdDialog","$mdBottomSheet","groupService","shopLocationsService",function(a,b,c,d,e,f,g,h,i,j){a.rightEditView="views/authenticated/shopLocations/manageShopLocations.html",a.isTabsLoad=!1,a.searchFilter="",a.selectedLocationId="",a.isPagingCursor=!1,a.isMoreShopLocations=!1,a.filter={filter:"",group_id:""},a.fnInitShopLocations=function(){a.fnCreateFilters()},a.fnCreateFilters=function(){a.selectGroupOptions=[{name:"All Groups",value:""}],i.fetchGroups().then(function(b){angular.forEach(b,function(b){a.selectGroupOptions.push({name:b.name,value:b.id})})}),a.selectGroup=a.selectGroupOptions[0].value,a.$watch("searchFilter",function(b){a.searchFilter=b,a.filter.filter=b,a.filter.group_id=a.selectGroup,a.getPagedDataAsync(a.filter)})},a.fnChangeGroup=function(b){a.filter.group_id=b,a.getPagedDataAsync(a.filter)},a.setData=function(b){angular.forEach(b,function(a){a.lastConfig=JSON.parse(a.lastConfig),a.lastConfig&&(a.getSMSInfoNameAndDBHealth=a.lastConfig.sms_info.name+" - "+a.lastConfig.sms_info.db_health)}),a.shopLocationsData=b,a.$$phase||a.$apply()},a.getPagedDataAsync=function(b){a.isShopLocationsMsgShow=!1,a.isShopLocationsDataNotNull=!1,setTimeout(function(){b?j.filterShopLocationsData(b).then(function(b){0!==b.data.length?(a.isShopLocationsMsgShow=!1,a.isShopLocationsDataNotNull=!0,a.setData(b.data)):(a.isShopLocationsDataNotNull=!1,a.isShopLocationsMsgShow=!0),a.isShopLocationsDataNotNull&&!a.isShopLocationsMsgShow&&(a.isPagingCursor=!b.headers["x-paging-cursor"])}):j.filterShopLocationsData(b).then(function(b){0!==b.data.length?(a.isShopLocationsMsgShow=!1,a.isShopLocationsDataNotNull=!0,a.setData(b.data)):(a.isShopLocationsDataNotNull=!1,a.isShopLocationsMsgShow=!0),a.isShopLocationsDataNotNull&&!a.isShopLocationsMsgShow&&(a.isPagingCursor=!b.headers["x-paging-cursor"])})},100)},a.selectedShopLocations=[],a.colorIndicator='<div class="checked_item" style="margin-bottom: 5px;" location-indicator     data-obj="row.entity"></div>',a.shopLocationsAction='<div layout="row"><md-button class="md-icon-button md-primary" ng-click="grid.appScope.fnShopLocationsEdit(row, $event);">   <md-icon md-font-set="material-icons">visibility</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Open</md-tooltip></md-button></div>',a.shopLocationsGridOptions={data:"shopLocationsData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,columnDefs:[{name:"status",displayName:"",cellTemplate:a.colorIndicator,width:50,enableSorting:!1,enableColumnMenu:!1},{field:"name",displayName:"Location",minWidth:100,enableHiding:!1},{field:"subscriptions",displayName:"Subscriptions",minWidth:100,enableHiding:!1},{field:"phone",displayName:"Phone",minWidth:100,enableHiding:!1},{field:"currentVersion",displayName:"Sync app’s version",minWidth:100,enableHiding:!1},{name:"action",displayName:"",cellTemplate:a.shopLocationsAction,width:50,enableSorting:!1,enableColumnMenu:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnShopLocationsEdit=function(b){a.fnOpenManageShopLocationsSwapView(b)},a.fnCloseNewShopLocationsSwap=function(){b("newShopLocationView").close().then(function(){})},a.fnLoadMoreShopLocations=function(){a.isMoreShopLocations=!0,j.fetchMoreShopLocations().then(function(b){a.shopLocationsData=a.shopLocationsData.concat(b.data),a.isPagingCursor=!b.headers["x-paging-cursor"],a.isMoreShopLocations=!1})},a.fnOpenManageShopLocationsSwapView=function(c){a.shopLocationObj=c.entity,j.setShopLocationsObj(c.entity),setTimeout(function(){a.rightEditView="",a.$apply(),a.rightEditView="views/authenticated/shopLocations/manageShopLocations.html",a.$apply(),a.isTabsLoad=!0,b("manageShopLocationsView").open().then(function(){})})},a.fnCloseManageShopLocationsSwapView=function(){a.isTabsLoad=!1,b("manageShopLocationsView").close().then(function(){j.setShopLocationsObj({})})},a.selectedIndex=0,a.fnSendDailyEmail=function(a,b){var d=["$scope",function(b){b.prevYear=moment().year()-1,b.selectedYear="",b.fnSendDailyEmail=function(){j.sendDailyEmail(a.id,b.selectedYear).then(function(){c.success("Email sent successfully.")}),b.fnCloseDialog()},b.fnCloseDialog=function(){g.cancel()}}];g.show({controller:d,template:'<md-dialog aria-label="Daily Email dialog">   <md-content layout="column" layout-margin>       <h2 layout-padding> Send Daily Email </h2>       <div layout="column" layout-margin>           <md-input-container>               <md-select aria-label="Select Year" ng-model="selectedYear">                   <md-option value="">Current Year</md-option>                   <md-option ng-value="prevYear">{{prevYear}}</md-option>               </md-select>           </md-input-container>       <div>       <div layout-margin> Are you sure you want to send the email?</div>       <div layout="row" layout-align="end center">           <md-button class="md-raised md-primary"                       ng-click="fnSendDailyEmail();">Send</md-button>           <md-button class="md-raised md-warn" style="margin:0px 10px !important;"                       ng-click="fnCloseDialog();">Cancel</md-button>       </div>    </md-content></md-dialog>',targetEvent:b}).then(function(a){},function(a){})},a.$on("locationChanged",function(b,c){a.selectedLocationId=c,b.stopPropagation()}),a.fnOpenBottomSheet=function(){var b=$("#manage-shoploc-sidenav.md-sidenav-right");b.css("overflow","hidden"),h.show({scope:a.$new(),clickOutsideToClose:!0,parent:b,template:'<md-bottom-sheet class="md-grid" layout="column" ng-cloak>   <div layout="row" layout-align="start center" >       <md-button class="md-raised md-primary"                   ng-click="fnSendDailyEmail(shopLocationObj, $event);">Send Daily Email       </md-button>   </div></md-bottom-sheet>'}).then(function(){},function(){b.css("overflow-y","auto")})}}]),app.controller("shopLocationsConfigCtrl",["$scope","$filter","shopLocationsService",function(a,b,c){a.shopLocationData=c.getShopLocationsObj().id?angular.copy(c.getShopLocationsObj()):{},a.fnInitShopLocConfig=function(){null!==a.shopLocationData.lastConfig&&(a.shopLocationData.lastConfig.settings["carglyconnect.lastsync"]=b("date")(a.shopLocationData.lastConfig.settings["carglyconnect.lastsync"],"M/d/yyyy h:mm a")),a.lastConfig=a.shopLocationData.lastConfig,a.sms_info=a.lastConfig?a.lastConfig.sms_info:{},a.settings=a.lastConfig?a.lastConfig.settings:{},a.environment=a.lastConfig?a.lastConfig.environment:{}}}]),app.controller("shopLocationsDashboardCtrl",["$scope","$rootScope","$mdDialog","$filter","$timeout","toastr","shopLocationsService","shopLocationsDashboardServices",function(a,b,c,d,e,f,g,h){function i(b,c,d,e){var f=isNaN(c)||0===c?0:(b-c)/c;f=parseInt(100*f.toFixed(2));var g={};g.value=(0>f?f:"+"+f)+"%",
g.colorCode=0>f?"#ff0000":"#008000";var h={};h[d]=g,angular.extend(w,h),a.varianceObj[e]=angular.copy(w)}function j(){1===x?a.isSummary2015Data=!0:++x}function k(b){var c=b.new_customers;c=0>c?0:c;var d=b.active_customers,e=d-c;e=0>e?0:e;var f=b.lost_customers;return f=0>f?0:f,0===c&&0===e&&0===f?void(a.isPieChartDataMsg=!0):(a.createPieChartJson={"Newly Active":c,"Other Active":e,Lost:f},a.isPieChartCustData=!0,a.isPieChartDataMsg=!1,void a.fnGeneratePieChart(b))}function l(){y={isDailyBarVisited:!1,isEmployeeBarVisited:!1,isCustomerBarVisited:!1,isMarketingBarVisited:!1}}function m(){y.isDailyBarVisited||withinviewport($("#dashboard-tab section#daily-barchart-section div.roContainer"))&&(console.log("Daily-Barchart-Section: Call for /repair-order API"),y.isDailyBarVisited=!0,a.fnRepairOrders(a.selectedLocationOption,t,u)),y.isEmployeeBarVisited||withinviewport($("#dashboard-tab section#employee-barchart-section"))&&(console.log("Employee-Barchart-Section: Call for /reports/writer_stats_by_month and /reports/tech_stats_by_month API"),y.isEmployeeBarVisited=!0,a.fnFetchWriterStatsByMonth(a.selectedLocationOption)),y.isCustomerBarVisited||withinviewport($("#dashboard-tab section#customer-barchart-section div.custBarContainer"))&&(console.log("Customer-Barchart-Section: Call for /reports/customers_by_month API"),y.isCustomerBarVisited=!0,a.fnFetchCustomerReport(a.selectedLocationOption)),y.isMarketingBarVisited||withinviewport($("#dashboard-tab section#marketing-barchart-section"))&&(console.log("Marketing-Barchart-Section: Call for /reports/marketing_sources_by_month API"),y.isMarketingBarVisited=!0,a.fnFetchMarketingSourceByMonth(a.selectedLocationOption))}a.shopLocation=g.getShopLocationsObj()?g.getShopLocationsObj():{};var n=a.shopLocation.partnerId;a.locationDDOptions=[],a.selectedLocationOption="",a.isDailySummaryData=!1,a.currentYearData=a.priorYearData=a.last_12_months=a.last_30_days={},a.summaryDDOptions=[],a.selectedSummaryOption="",a.curr_summary_2015=a.prior_summary_2015=a.dec_summary_2015={},a.isSummary2015Data=!1,a.empPerformanceDDOptions=[],a.selectedEmpPerformanceOption="",a.createEmpPerformanceJSON={},a.isEmpPerformanceDataLoaded=!1,a.isEmpPerformanceMsg=!1,a.createMarketingSourceArr=[],a.isMarketingSourcesDataLoaded=!1,a.isMarketingSourcesMsg=!1,a.custRepoOptions=[],a.selectedCustRepoOptions="";var o=["Jan","Feb","March","April","May","June","July","Aug","Sept","Oct","Nov","Dec"],p=["January","February","March","April","May","June","July","August","September","October","November","December"];a.getLast12Month=[];var q=(new Date).getDate(),r=(new Date).getMonth()+1,s=(new Date).getFullYear();a.fnCheckEventStartDate=function(a,b,c){var d="";return d=new Date(a,b,0).getDate()===c?12===b?a+1+"-01-01T05:00:00.000Z":a+"-"+(b+1)+"-01T05:00:00.000Z":a+"-"+b+"-"+(c+1)+"T05:00:00.000Z"};var t=a.fnCheckEventStartDate(s,r,q),u=s+"-"+r+"-"+q+"T05:00:00.000Z";a.createJSON={},a.createPieChartJson={};var v=["gross_sales_cents","average_daily_sales_gross_cents","average_sale_cents","average_daily_sales_count"];a.varianceObj=[];var w={};a.isMonthlySummaryData=!1,a.monthToDate={},a.fnGetLocationDetails=function(){a.locationDDOptions=[],h.fetchLocations(n).then(function(b){a.fnCreateLocationDD(b)},function(a){f.error("Retrieving locations failed.","STATUS CODE: "+a.status)})},a.fnCreateLocationDD=function(b){angular.forEach(b,function(b){a.locationDDOptions.push({id:b.id,name:b.name})}),a.locationDDOptions.unshift({id:"",name:"All locations"}),a.selectedLocationOption=a.shopLocation.id,a.fnLocationChange(a.selectedLocationOption)},a.fnLocationChange=function(b){a.currentDate=moment().toDate(),console.log("Summary-Section: Call for /reports/daily_summary API"),a.fnGetDailySummary(b),console.log("Monthly-Barchart-section: Call for /reports/monthly_summary API"),a.fnGetMonthlySummaryWithDateAndLocation(b),l(),m()},a.fnCalculateGrossProfitCent=function(a){var b=0;return b=a.total_labor_profit_cents+a.total_parts_profit_cents+a.total_sublet_profit_cents-a.total_discount_cents},a.fnCalcOverPrevYear=function(b,c,d){var e,f;e=f=0,angular.forEach(v,function(a){e=b[a]/100,f=c[a]/100,i(e,f,a,d)}),e=a.fnCalculateGrossProfitCent(b),f=a.fnCalculateGrossProfitCent(c),i(e/100,f/100,"gross_profit_dollar",d),e=0==b.gross_sales_cents?0:e/b.gross_sales_cents*100,f=0==c.gross_sales_cents?0:f/c.gross_sales_cents*100,i(e,f,"gross_profit_per",d)};var x=0;a.fnSummaryOptionChanged=function(b,c){if("2015"===b){x=0,a.isSummary2015Data=!1,h.fetchDailySummary(n,c,b).then(function(b){a.curr_summary_2015=b.current_year,a.prior_summary_2015=b.prior_year,a.fnCalcOverPrevYear(a.curr_summary_2015,a.prior_summary_2015,1),j()});var d="2015-12-01",e="2015-12-31";h.fetchMonthlySummaryWithDateAndLoc(n,c,d,e).then(function(b){a.dec_summary_2015=b.summaries.pop(),j()})}},a.fnCreateSummaryDD=function(){a.summaryDDOptions=[{name:"Year-to-date/Month-to-date",value:"year_month_to_date"},{name:"Last 12 months/Last 30 days",value:"last_12_months_30_days"},{name:"2015",value:"2015"}]},a.fnGetDailySummary=function(b){a.isDailySummaryData=!1,h.fetchDailySummary(n,b).then(function(b){a.currentYearData=b.current_year,a.priorYearData=b.prior_year,a.last_12_months=b.last_12_months,a.last_30_days=b.last_30_days,a.fnCreateSummaryDD(),a.fnCalcOverPrevYear(a.currentYearData,a.priorYearData,0),a.isDailySummaryData=!0},function(a){f.error("Retrieving daily summary failed.","STATUS CODE: "+a.status)})},a.fnGetMonthlySummaryWithDateAndLocation=function(b){a.isMonthlySummaryData=!1;var c=moment().subtract(2,"year").add(1,"months").subtract(1,"day").format("YYYY-MM-DD"),d=moment().daysInMonth();d=moment().date(d).format("YYYY-MM-DD"),h.fetchMonthlySummaryWithDateAndLoc(n,b,c,d).then(function(b){a.fnCreatechartGroupsDD(),a.isMonthlySummaryData=!0;var c=angular.copy(b.summaries);a.monthlySummary=b.summaries,a.fnCreateJSON(a.monthlySummary),a.monthToDate=c.pop()},function(a){f.error("Retrieving monthly summary failed.","STATUS CODE: "+a.status)})},a.fnRepairOrders=function(b,c,d){a.isRepairOrdersData=!1,b?h.fetchRepairOrderWithDate(b,c,d).then(function(b){a.isRepairOrdersData=!0,a.isLocId=!0,b.length>0?(a.repairOrders=b,a.isRepairOrderMsg=!1):a.isRepairOrderMsg=!0}):(a.isLocId=!1,a.isRepairOrdersData=!0,a.isRepairOrderMsg=!1),a.fnRefreshDom()},a.fnOpenRepairOrderModal=function(a,b,d){c.show({controller:"repairOrderModalCtrl",templateUrl:"views/authenticated/shopLocations/modals/roDetailsDialog.html",targetEvent:a,resolve:{repairOrder:function(){return b},repairOrders:function(){return d}}})},a.fnCreateJSON=function(b){a.createJSON={};var c=b[0],e="",f=[],g=[];for(var h in c)c.hasOwnProperty(h)&&(a.createJSON[h]=[]);a.createJSON.gross_profit_cents=[],a.createJSON.shop_efficiency=[],a.createJSON.sold_hours_per_ro=[],angular.forEach(b,function(b,h){var i=d("CentToDollar")(a.fnCalculateGrossProfitCent(b));for(var j in b)b.hasOwnProperty(j)&&("labor_sold_cents_per_second"!==j&&j.split("_").indexOf("cents")>-1&&(b[j]=d("CentToDollar")(b[j])),"rate"===j.split("_").pop()&&(b[j]=d("multiplyBy100")(b[j])),j.split("_").indexOf("seconds")>-1&&(b[j]=d("hour")(b[j])));b.labor_sold_cents_per_second&&(b.labor_sold_cents_per_second=d("calEffectiveRate")(b.labor_sold_cents_per_second));var k=0!=b.total_labor_actual_seconds?(b.total_labor_sold_seconds/b.total_labor_actual_seconds).toFixed(2):0,l=0!=b.sale_count?(b.total_labor_sold_seconds/b.sale_count).toFixed(2):0,m=o[b.month-1];if(12>h?(e="Previous 12 months",-1===g.indexOf(e)&&g.push(e)):(e="Most recent 12 months",-1===g.indexOf(e)&&g.push(e)),-1!==f.indexOf(b.month)){for(var n in c)c.hasOwnProperty(n)&&a.fnCheckMonthInObj(m,e,a.createJSON[n],b[n]);a.fnCheckMonthInObj(m,e,a.createJSON.gross_profit_cents,i),a.fnCheckMonthInObj(m,e,a.createJSON.shop_efficiency,k),a.fnCheckMonthInObj(m,e,a.createJSON.sold_hours_per_ro,l)}else{f.push(b.month);for(var p in c)c.hasOwnProperty(p)&&a.fnPushObj(m,e,a.createJSON[p],b[p]);a.fnPushObj(m,e,a.createJSON.gross_profit_cents,i),a.fnPushObj(m,e,a.createJSON.shop_efficiency,k),a.fnPushObj(m,e,a.createJSON.sold_hours_per_ro,l)}}),a.setColumnValue=g},a.fnPushObj=function(a,b,c,d){var e={};e.month=a,e[b]=d,c.push(e)},a.fnCheckMonthInObj=function(a,b,c,d){$.each(c,function(c,e){e.month===a&&(e[b]=d)})},a.chartGroupsOptions=[{name:"Key Indicators",value:"key_indicators"},{name:"Gross Sales",value:"gross_sales"},{name:"Cost of Sales",value:"cost_of_sales"},{name:"Gross Profit",value:"gross_profit"},{name:"Marketing",value:"marketing"},{name:"Repair Order Analysis",value:"repair_order_analysis"},{name:"Miscellaneous",value:"miscellaneous"}],a.fnCreatechartGroupsDD=function(){a.chartGroupsOptions=[{name:"Key Indicators",value:"key_indicators"},{name:"Gross Sales",value:"gross_sales"},{name:"Cost of Sales",value:"cost_of_sales"},{name:"Gross Profit",value:"gross_profit"},{name:"Marketing",value:"marketing"},{name:"Repair Order Analysis",value:"repair_order_analysis"},{name:"Miscellaneous",value:"miscellaneous"}]},a.selectedGroupOption=a.chartGroupsOptions[0],a.chartGroups={cost_of_sales:[{name:"Labor Cost $",value:"total_labor_cost_cents"},{name:"Parts Cost $",value:"total_parts_cost_cents"},{name:"Sublet Cost $",value:"total_sublet_cost_cents"}],gross_profit:[{name:"Gross Profit $ Total",value:"gross_profit_cents"},{name:"Labor Gross Profit $",value:"total_labor_profit_cents"},{name:"Parts Gross Profit $",value:"total_parts_profit_cents"},{name:"Sublet Gross Profit $",value:"total_sublet_profit_cents"}],gross_sales:[{name:"Discounts $",value:"total_discount_cents"},{name:"Gross Sales $ Total",value:"gross_sales_cents"},{name:"Labor Sold $",value:"total_labor_sold_cents"},{name:"Other Sold $",value:"total_other_sold_cents"},{name:"Parts Sold $",value:"total_parts_sold_cents"},{name:"Sublet Sold $",value:"total_sublet_sold_cents"}],key_indicators:[{name:"Gross Sales $ Total",value:"gross_sales_cents"},{name:"Actual Hours Total",value:"total_labor_actual_seconds"},{name:"Average RO Sales $",value:"average_sale_cents"},{name:"Daily RO Count Average",value:"average_daily_sales_count"},{name:"Daily Sales $ Average",value:"average_daily_sales_gross_cents"},{name:"Effective Labor Rate $",value:"labor_sold_cents_per_second"},{name:"Gross Profit % Total",value:"labor_and_parts_profit_rate"},{name:"Labor Gross Profit %",value:"labor_profit_rate"},{name:"Parts Gross Profit %",value:"parts_profit_rate"},{name:"RO Count",value:"sale_count"},{name:"Shop Efficiency",value:"shop_efficiency"},{name:"Sold Hours per RO",value:"sold_hours_per_ro"},{name:"Sold Hours Total",value:"total_labor_sold_seconds"},{name:"Sublet Gross Profit %",value:"sublet_profit_rate"}],marketing:[{name:"New Customers Count",value:"new_customers_count"},{name:"Returning Customers Count",value:"returning_customers_count"}],miscellaneous:[{name:"Day Count",value:"day_count"},{name:"Gross Sales $ with Taxes",value:"gross_sales_after_tax_cents"},{name:"Labor Cost $ per RO",value:"average_labor_cost_cents"},{name:"Labor Profit $ per RO",value:"average_labor_profit_cents"},{name:"Labor Sold $ After Discounts",value:"total_labor_sold_cents_after_discounts"},{name:"Parts Cost $ per RO",value:"average_parts_cost_cents"},{name:"Parts Profit $ per RO",value:"average_parts_profit_cents"},{name:"Parts Sold $ After Discounts",value:"total_parts_sold_cents_after_discounts"},{name:"Sublet Cost $ per RO",value:"average_sublet_cost_cents"},{name:"Sublet Profit $ per RO",value:"average_sublet_profit_cents"},{name:"Sublet Sold $ After discounts",value:"total_sublet_sold_cents_after_discounts"},{name:"Taxes $",value:"total_tax_paid_cents"}],repair_order_analysis:[{name:"Average RO Sales $",value:"average_sale_cents"},{name:"Discount $ per RO",value:"average_discount_cents"},{name:"Labor $ per RO",value:"average_labor_sold_cents"},{name:"Other Sales $ per RO",value:"average_other_sold_cents"},{name:"Parts $ per RO",value:"average_parts_sold_cents"},{name:"RO Count",value:"sale_count"},{name:"Sublet $ per RO",value:"average_sublet_sold_cents"}]},a.chartOptions=a.chartGroups[a.selectedGroupOption.value],a.selectedChartType=a.chartOptions[0],a.barChartName=a.selectedChartType.name,a.sendJsonToBar=a.createJSON[a.selectedChartType.value],a.fnChangeGroup=function(b){a.chartOptions=a.chartGroups[b.value],a.barChartName=a.selectedChartType.name},a.sendJsonToBar=[],a.fnGenerateBarChart=function(b,c){b&&(a.barChartName=b.name,a.sendJsonToBar=a.createJSON[b.value],a.fnGenerateMonthlyBarChart(b,c),"day_count"!==b.value&&"average_daily_sales_count"!==b.value&&"average_daily_sales_gross_cents"!==b.value&&a.fnGenerateDailyBarChart(11,"Most recent 12 months",b,c))},a.fnReturnTooltipVal=function(a,b){var c="";return c="gross_sales_cents"===a||"average_sale_cents"===a||"average_daily_sales_gross_cents"===a||"labor_sold_cents_per_second"===a||"total_labor_sold_cents"===a||"total_labor_cost_cents"===a||"total_labor_profit_cents"===a||"total_parts_sold_cents"===a||"total_parts_cost_cents"===a||"total_parts_profit_cents"===a||"total_discount_cents"===a||"average_labor_sold_cents"===a||"average_labor_cost_cents"===a||"average_labor_profit_cents"===a||"average_parts_sold_cents"===a||"average_parts_cost_cents"===a||"average_parts_profit_cents"===a||"average_discount_cents"===a||"total_labor_sold_cents_after_discounts"===a||"total_parts_sold_cents_after_discounts"===a||"total_sublet_sold_cents"===a||"total_sublet_cost_cents"===a||"total_sublet_profit_cents"===a||"average_sublet_sold_cents"===a||"average_sublet_cost_cents"===a||"average_sublet_profit_cents"===a||"total_sublet_sold_cents_after_discounts"===a||"gross_sales_after_tax_cents"===a||"total_tax_paid_cents"===a||"total_other_sold_cents"===a||"average_other_sold_cents"===a||"gross_profit_cents"===a?d("currency")(b):"labor_and_parts_profit_rate"===a||"parts_profit_rate"===a||"labor_profit_rate"===a||"sublet_profit_rate"===a?b+"%":"average_daily_sales_count"===a?d("number")(b,2):b},a.fnGenerateMonthlyBarChart=function(c,d){if(a.isMonthlySummaryData){var e=0;a.isMonthlyBarMsg=!1;c3.generate({bindto:"#bar-chart",padding:{top:40,right:50},data:{json:a.sendJsonToBar,keys:{x:"month",value:a.setColumnValue},type:"bar",colors:{"Previous 12 months":"#1F77B4","Most recent 12 months":"#FF7F0E"},color:function(a,b){return 0===b.value&&e++,a},onclick:function(e){e.name?"day_count"!==c.value&&"average_daily_sales_count"!==c.value&&"average_daily_sales_gross_cents"!==c.value&&a.fnGenerateDailyBarChart(e.index,e.name,c,d):b.isMobile&&f.info("Please put your finger on the specific target.")}},grid:{y:{show:!0}},onrendered:function(){a.isMonthlyBarMsg=a.sendJsonToBar.length+12===e,a.fnRefreshDom(),e=0},transition:{duration:1e3},bar:{width:{ratio:.5}},zoom:{enabled:!1},axis:{x:{label:{text:"Month",position:"outer-center"},type:"category",height:50,tick:{rotate:75,multiline:!1}},y:{label:{text:a.barChartName,position:"outer-middle"}}},tooltip:{grouped:!0,contents:function(b,d,e,f){var g,h,i,j,k,l,m=this,n=m.config,o=n.tooltip_format_name||function(a){return a},p=n.tooltip_format_value||e,q=!0;for(g||(g='<table class="'+m.CLASS.tooltip+'"><tr><th colspan="2">'+a.barChartName+"</th></tr>"),h=0;h<b.length;h++)b[h]&&(b[h].value||0===b[h].value)&&(j=o(b[h].name),i=p(b[h].value,b[h].ratio,b[h].id,b[h].index),k=m.levelColor?m.levelColor(b[h].value):f(b[h].id),0!==b[h].value&&(q=!1),l=a.fnReturnTooltipVal(c.value,i),g+='<tr class="'+m.CLASS.tooltipName+"-"+b[h].id+'"><td class="name"><span style="background-color:'+k+'"></span>'+j+'</td><td class="value">'+l+"</td></tr>");if(!q){if(void 0!==b[0]&&void 0!==b[1]){var r=b[0].value<b[1].value?b[1].value-b[0].value:b[0].value-b[1].value;r%1!==0&&(r=r.toFixed(2)),l=a.fnReturnTooltipVal(c.value,r),g+='<tr style="text-align: right"><td>Variance</td><td>'+l+"</td></tr>"}return g+='<tr><td colspan="2">Click a month to see daily details.</td></tr></table>'}}}})}},a.fnGenerateDailyBarChart=function(b,c,e,g,i){function j(b,c,d,e,f,g,h){var i={};"Previous 12 months"===d?i[e]="#1F77B4":"Most recent 12 months"===d&&(i[e]="#FF7F0E");var j=0;if(a.isDailyBarMsg=!1,a.isDailySummaryData){c3.generate({bindto:"#daily-bar-chart",padding:{top:40,right:50},data:{json:b,keys:{x:"day",value:[e]},type:"bar",colors:i,color:function(a,b){return 0===b.value&&j++,a},onclick:function(b){var c=a.fnCheckEventStartDate(f,g,b.index+1),d=f+"-"+g+"-"+(b.index+1)+"T05:00:00.000Z";a.currentDate=new Date(f,g-1,b.index+1),a.fnRepairOrders(h,c,d)}},grid:{y:{show:!0}},onrendered:function(){a.isDailyBarMsg=b.length===j,a.fnRefreshDom(),j=0},transition:{duration:1e3},bar:{width:{ratio:.5}},zoom:{enabled:!1},axis:{x:{label:{text:c,position:"outer-center"},type:"category",height:50,tick:{rotate:75,multiline:!1}},y:{label:{text:a.yAxiesLabel,position:"outer-middle"}}},tooltip:{grouped:!1,contents:function(b,c,d,e){var f=b[0].name,g=b[0].value,h=a.fnReturnTooltipVal(f,g),j='<table class="c3-tooltip"><tbody><tr><th colspan="2">'+a.dailyHeading+'</th></tr><tr class="c3-tooltip-name-'+f+'"><td class="name"><span style="background-color:'+i[f]+'"></span>'+a.dailyHeading+'</td><td class="value">'+h+'</td></tr><tr><td colspan="2">Click a day to see repair orders</td></tr></tbody></table>';return j}},legend:{hide:!0}})}}angular.forEach(a.createJSON[e.value],function(k,l){if(l===b){var m="",q=o.indexOf(k.month)+1;"Previous 12 months"===c&&q>r?m=s-2:"Previous 12 months"===c&&r>=q?m=s-1:"Most recent 12 months"===c&&q>r?m=s-1:"Most recent 12 months"===c&&r>=q&&(m=s),a.isDailySummaryData=i?i:!0,h.fetchMonthlyData(n,g,m+"-"+q).then(function(b){a.isDailySummaryData=!0;var f=b.summaries;angular.forEach(f,function(b,c){var e=d("CentToDollar")(a.fnCalculateGrossProfitCent(b));b.gross_profit_cents=e;for(var f in b)b.hasOwnProperty(f)&&("labor_sold_cents_per_second"!==f&&f.split("_").indexOf("cents")>-1&&(b[f]=d("CentToDollar")(b[f])),"rate"===f.split("_").pop()&&(b[f]=d("multiplyBy100")(b[f])),f.split("_").indexOf("seconds")>-1&&(b[f]=d("hour")(b[f])));b.labor_sold_cents_per_second&&(b.labor_sold_cents_per_second=d("calEffectiveRate")(b.labor_sold_cents_per_second));var g=0!=b.total_labor_actual_seconds?(b.total_labor_sold_seconds/b.total_labor_actual_seconds).toFixed(2):0;b.shop_efficiency=g;var h=0!=b.sale_count?(b.total_labor_sold_seconds/b.sale_count).toFixed(2):0;b.sold_hours_per_ro=h}),a.dailyBarMonth=p[f[0].month-1],j(f,a.dailyBarMonth,c,e.value,m,q,g)},function(a){f.error("Failed retrieving monthly details.","STATUS CODE: "+a.status)})}}),a.yAxiesLabel=e.name,a.dailyHeading=e.name},a.fnCreateempPerformanceDD=function(){a.empPerformanceDDOptions=[{name:"Service Advisor Gross Sales",value:"gross_sales_cents"},{name:"Service Advisor Avg. RO",value:"avg_sale_cents"},{name:"Service Advisor RO Count",value:"sale_count"},{name:"Service Advisor Gross Profit",value:"gross_profit_cents"},{name:"Service Advisor Gross Profit %",value:"gross_profit_cents_per"},{name:"Tech Sold",value:"total_labor_sold_cents"},{name:"Tech Cost",value:"total_labor_cost_cents"},{name:"Tech Profit",value:"total_labor_profit_cents"},{name:"Tech Actual Time",value:"total_actual_seconds"},{name:"Tech Effective Labor Rate",value:"eff_labor_hourly_rate_cents"}],a.empPerformanceBarChartName=a.empPerformanceDDOptions[0].name,a.selectedEmpPerformanceOption=a.empPerformanceDDOptions[0].value},a.fnFetchWriterStatsByMonth=function(b){a.isEmpPerformanceDataLoaded=a.isEmpPerformanceMsg=!1,a.createEmpPerformanceJSON={},h.fetchWriterStatsByMonth(n,b).then(function(c){a.fnCreateempPerformanceDD(),c.length>0?a.fnCreateEmpPerformanceChartJSON(c,c[0].writers[0],"writers"):a.isEmpPerformanceMsg=!0,a.fnFetchTechStatsByMonth(b)}),a.fnRefreshDom()},a.fnFetchTechStatsByMonth=function(b){h.fetchTechStatsByMonth(n,b).then(function(b){a.isEmpPerformanceDataLoaded=!0,b.length>0&&a.fnCreateEmpPerformanceChartJSON(b,b[0].techs[0],"techs")})},a.fnCreateEmpPerformanceChartJSON=function(b,c,e){var f=c,g="_emp",h="gross_profit_cents_per";for(var i in f)f.hasOwnProperty(i)&&"name"!=i&&(a.createEmpPerformanceJSON[i]=[],a.createEmpPerformanceJSON[i+g]=[]);"undefined"!=typeof c&&"writers"===e&&(a.createEmpPerformanceJSON[h]=[],a.createEmpPerformanceJSON[h+g]=[]),angular.forEach(b,function(b){var c=o[b.month-1]+"-"+b.year;angular.forEach(b[e],function(b){if("writers"===e){var f=0==b.gross_sales_cents?0:(b.gross_profit_cents/b.gross_sales_cents*100).toFixed(2);"undefined"==typeof a.createEmpPerformanceJSON[h+g]&&(a.createEmpPerformanceJSON[h+g]=[]),"undefined"==typeof a.createEmpPerformanceJSON[h]&&(a.createEmpPerformanceJSON[h]=[]),-1===a.createEmpPerformanceJSON[h+g].indexOf(b.name)&&a.createEmpPerformanceJSON[h+g].push(b.name);var i=a.createEmpPerformanceJSON[h].map(function(a){return a.month}).indexOf(c);if(-1===i){var j={};j.month=c,j[b.name]=f,a.createEmpPerformanceJSON[h].push(j)}else angular.forEach(a.createEmpPerformanceJSON[h],function(a){a.month==c&&(a[b.name]=f)})}angular.forEach(b,function(e,f){if("name"!=f){"undefined"==typeof a.createEmpPerformanceJSON[f+g]&&(a.createEmpPerformanceJSON[f+g]=[]),"undefined"==typeof a.createEmpPerformanceJSON[f]&&(a.createEmpPerformanceJSON[f]=[]),-1===a.createEmpPerformanceJSON[f+g].indexOf(b.name)&&a.createEmpPerformanceJSON[f+g].push(b.name);var h=a.createEmpPerformanceJSON[f].map(function(a){return a.month}).indexOf(c);if(-1===h){var i={};i.month=c,f.split("_").indexOf("cents")>-1?i[b.name]=d("CentToDollar")(e):f.split("_").indexOf("seconds")>-1?i[b.name]=d("hour")(e):i[b.name]=b[f],a.createEmpPerformanceJSON[f].push(i)}else angular.forEach(a.createEmpPerformanceJSON[f],function(a){a.month==c&&(f.split("_").indexOf("cents")>-1?a[b.name]=d("CentToDollar")(e):f.split("_").indexOf("seconds")>-1?a[b.name]=d("hour")(e):a[b.name]=e)})}})})}),0==Object.keys(a.createEmpPerformanceJSON).length&&(a.isEmpPerformanceMsg=!0)},a.fnGenerateBarEmpPerChart=function(b){a.isEmpPerformanceMsg||0!=Object.keys(a.createEmpPerformanceJSON).length&&c3.generate({bindto:"#bar-chart-emp-performance",padding:{top:40,right:50},data:{json:a.createEmpPerformanceJSON[b],keys:{x:"month",value:a.createEmpPerformanceJSON[b+"_emp"]},type:"bar"},grid:{y:{show:!0}},transition:{duration:1e3},bar:{width:{ratio:.5}},zoom:{enabled:!1},axis:{x:{label:{text:"Month",position:"outer-center"},type:"category",height:100,tick:{rotate:-75,multiline:!1}}},tooltip:{format:{value:function(a,c,d){var e=b.split("_").indexOf("cents")>-1?d3.format("$"):d3.format(",");return b.split("_").indexOf("per")>-1?a+"%":e(a)}}}})},a.fnGeneratePieChart=function(b){if(a.pieChartTitle=o[b.month-1]+" "+b.year,a.isPieChartCustData){c3.generate({bindto:"#pie-chart",data:{json:a.createPieChartJson,type:"pie",onclick:function(a,b){},onmouseover:function(a,b){},onmouseout:function(a,b){}},tooltip:{grouped:!1,contents:function(b,c,d,e){var f=b[0].name,g=b[0].value;"Newly Active"===f?e="#1F77B4":"Other Active"===f?e="#FF7F0E":"Lost"===f&&(e="#2CA02C");var h='<table class="c3-tooltip"><tbody><tr><th colspan="2">'+a.pieChartTitle+', Customers</th></tr><tr class="c3-tooltip-name-'+f+'"><td class="name"><span style="background-color:'+e+'"></span>'+f+'</td><td class="value">'+g+"</td></tr></tbody></table>";return h}}})}else a.isPieChartDataMsg=!0},a.custRepoOptions=[{name:"New Customers",value:"new_customers"},{name:"Active Customers",value:"active_customers"},{name:"Lost Customers",value:"lost_customers"}],a.fnCreatecustRepoDD=function(){a.custRepoOptions=[{name:"New Customers",value:"new_customers"},{name:"Active Customers",value:"active_customers"},{name:"Lost Customers",value:"lost_customers"}]},a.custRepoBarChartName=a.custRepoOptions[0].name,a.selectedCustRepoOptions=a.custRepoOptions[0].value,a.createCustRepoJSON={},a.sendCustRepoJsonToBar=[],a.fnFetchCustomerReport=function(b){a.isCustomerReportData=a.isPieChartCustData=!1,a.createCustRepoJSON={},h.fetchCustomerReport(n,b).then(function(b){a.fnCreatecustRepoDD(),a.customerReportData=b,a.isCustomerReportData=a.isPieChartCustData=!0,a.fnCreateCustRepoJson(b)}),a.fnRefreshDom()},a.fnCreateCustRepoJson=function(b){var c=b[0],d="",e=[],f=[];for(var g in c)c.hasOwnProperty(g)&&(a.createCustRepoJSON[g]=[]);angular.forEach(b,function(b,g){var h=o[b.month-1];if(12>g?(d="Previous 12 months",-1===e.indexOf(d)&&e.push(d)):(d="Most recent 12 months",-1===e.indexOf(d)&&e.push(d)),-1!==f.indexOf(b.month))for(var i in c)c.hasOwnProperty(i)&&a.fnCheckMonthInObj(h,d,a.createCustRepoJSON[i],b[i]);else{f.push(b.month);for(var j in c)c.hasOwnProperty(j)&&a.fnPushObj(h,d,a.createCustRepoJSON[j],b[j])}}),a.setColumnValue=e,k(b[b.length-1]),a.fnGenerateCustomerReportBarChart(a.selectedCustRepoOptions)},a.fnGenerateCustomerReportBarChart=function(b){angular.forEach(a.custRepoOptions,function(c){c.value===b&&(a.custRepoBarChartName=c.name)}),a.sendCustRepoJsonToBar=a.createCustRepoJSON[b];var c=0;if(a.isCustRepoBarMsg=!1,a.isCustomerReportData){c3.generate({bindto:"#customer-report-bar-chart",padding:{top:40,right:50},data:{json:a.sendCustRepoJsonToBar,keys:{x:"month",value:a.setColumnValue},type:"bar",colors:{"Previous 12 months":"#1F77B4","Most recent 12 months":"#FF7F0E"},color:function(a,b){return 0===b.value&&c++,a},onclick:function(b){k("Most recent 12 months"===b.id?a.customerReportData[b.index+12]:a.customerReportData[b.index])}},grid:{y:{show:!0}},onrendered:function(){a.isCustRepoBarMsg=a.sendCustRepoJsonToBar.length+12===c,a.fnRefreshDom(),c=0},transition:{duration:1e3},bar:{width:{ratio:.5}},zoom:{enabled:!1},axis:{x:{label:{text:"Month",position:"outer-center"},type:"category",height:50,tick:{rotate:75,multiline:!1}},y:{label:{text:a.custRepoBarChartName,position:"outer-middle"}}},tooltip:{grouped:!1,contents:function(b,c,d,e){var f=b[0].name,g=b[0].value;"Previous 12 months"===f?e="#1F77B4":"Most recent 12 months"===f&&(e="#FF7F0E");var h='<table class="c3-tooltip"><tbody><tr><th colspan="2">'+a.custRepoBarChartName+'</th></tr><tr class="c3-tooltip-name-'+f+'"><td class="name"><span style="background-color:'+e+'"></span>'+f+'</td><td class="value">'+g+'</td></tr><tr><td colspan="2">Click a month to see <br/> Active/New/Lost Customers </td></tr></tbody></table>';return h}}})}},a.fnFetchMarketingSourceByMonth=function(b){a.isMarketingSourcesDataLoaded=a.isMarketingSourcesMsg=!1,h.fetchMarketingSourceByMonth(n,b).then(function(b){a.isMarketingSourcesDataLoaded=!0,b.length>0?a.fnCreateMarketingSourceChartArr(b):a.isMarketingSourcesMsg=!0}),a.fnRefreshDom()},a.fnCreateMarketingSourceChartArr=function(b){a.createMarketingSourceArr=[],a.marketingSourceYAxisArr=[],a.isMarketingSourcesMsg=!1,angular.forEach(b,function(b){var c={};c.month=o[b.month-1]+"-"+b.year,angular.forEach(b.sources,function(b,d){c[d.trim()]=b,-1===a.marketingSourceYAxisArr.indexOf(d.trim())&&a.marketingSourceYAxisArr.push(d.trim())}),a.createMarketingSourceArr.push(c)}),0===a.marketingSourceYAxisArr.length&&(a.isMarketingSourcesMsg=!0),a.fnGenerateBarMSChart(a.createMarketingSourceArr,a.marketingSourceYAxisArr)},a.fnGenerateBarMSChart=function(b,c){c3.generate({bindto:"#bar-chart-marketing-sources",padding:{top:40,right:50},data:{json:b,keys:{x:"month",value:c},type:"bar"},grid:{y:{show:!a.isMarketingSourcesMsg}},transition:{duration:1e3},bar:{width:{ratio:.5}},zoom:{enabled:!1},axis:{x:{label:{text:"Month",position:"outer-center"},type:"category",height:100,tick:{rotate:-75,multiline:!1}}}})},a.fnInitDashboard=function(){a.fnGetLocationDetails(),a.fnCreatechartGroupsDD()},a.fnRefreshDom=function(){a.$$phase||a.$apply()};var y={};withinviewport.defaults.left=0,withinviewport.defaults.right=-100,withinviewport.defaults.bottom=-200,e(function(){$("#manage-shoploc-sidenav").on("scroll",function(){var b=$("#manage-shoploc-sidenav md-tabs md-tab[id=dashboard]");b&&0!=b.length&&0===a.selectedIndex&&m()}),$(window).resize(function(){var b=$("#manage-shoploc-sidenav md-tabs md-tab[id=dashboard]");b&&0!=b.length&&0===a.selectedIndex&&m()})},1e3)}]),app.controller("shopLocationsInfoCtrl",["$scope","$filter","shopLocationsService",function(a,b,c){a.shopLocationData=c.getShopLocationsObj().id?angular.copy(c.getShopLocationsObj()):{},a.fnInitShopLocInfo=function(){a.shopLocationData.lastConfigUpdated=b("date")(a.shopLocationData.lastConfigUpdated,"M/d/yyyy h:mm a"),null!==a.shopLocationData.lastConfig&&(a.shopLocationData.lastConfig.settings["carglyconnect.lastsync"]=b("date")(a.shopLocationData.lastConfig.settings["carglyconnect.lastsync"],"M/d/yyyy h:mm a"))}}]),app.controller("shopLocationsLogCtrl",["$scope","shopLocationsService",function(a,b){a.shopLocationData=b.getShopLocationsObj().id?angular.copy(b.getShopLocationsObj()):{};var c=a.shopLocationData.id?a.shopLocationData.id:null;a.logs=[],a.isProcessing=!1,a.fnInitShopLocLog=function(){a.fnFetchLog()},a.fnFetchLog=function(){c&&(a.isProcessing=!0,b.fetchLog(c).then(function(b){a.isProcessing=!1,a.logs=JSON.parse(b)}))}}]),app.controller("shopLocationsNextConfigCtrl",["$scope","shopLocationsService",function(a,b){function c(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}a.shopLocationData=b.getShopLocationsObj().id?angular.copy(b.getShopLocationsObj()):{};var d=a.shopLocationData.id?a.shopLocationData.id:null;a.shopLocationData.lastConfig=a.shopLocationData.lastConfig?a.shopLocationData.lastConfig:{settings:{"shopmgmtsystem.subscriptions":"timekeeping,inspections","shopmgmtsystem.type":"","shopmgmtsystem.db.location":"","carglyconnect.location.name":"","shopmgmtsystem.db.pinrequired":"","carglyconnect.location.address":"","carglyconnect.locationid":"","carglyconnect.lastsyncro":"","carglyconnect.url":"","shopmgmtsystem.db.password":"","server.ipaddress":"","carglyconnect.location.state":"","carglyconnect.location.city":"","carglyconnect.location.zip":"","carglyconnect.payments.publickey":"","shopmgmtsystem.logo":"","carglyconnect.location.phone":""}};var e=Object.keys(a.shopLocationData.lastConfig.settings).length;a.nextConfig={},a.keyDDArr=[{label:"Run Update",val:"run_update"},{label:"──────────",val:""}],a.selectedKey={},a.tableRowObjForDD={},a.isChecked=!1,a.isAddBtnShow=!1,a.isResetBtnShow=!1,a.isSaveDisabled=!1;var f="Config is currently being update, please wait…";a.fnCreateDD=function(){a.shopLocationData.lastConfig&&angular.forEach(a.shopLocationData.lastConfig,function(b,c){"settings"===c&&angular.forEach(b,function(b,c){a.keyDDArr.push({label:c,val:c})})})},a.fnInitDD=function(b,c,d){a.selectedKey[b]=b;for(var e=[],f=0;f<d.length;f++)void 0===c[d[f].val]?""!==d[f].val&&("run_update"===d[f].val?(e.unshift(a.keyDDArr[1]),e.unshift(a.keyDDArr[0])):e.push(d[f])):b===d[f].val&&("run_update"===b?(e.unshift(d[1]),e.unshift(d[f])):e.unshift(d[f]));a.tableRowObjForDD[b]=e,angular.forEach(a.tableRowObjForDD,function(c,d){angular.forEach(c,function(e,f){angular.forEach(a.selectedKey,function(a){e.val===a&&d!==a&&("run_update"===b?c.splice(f,2):c.splice(f,1))})})})},a.fnChangeDD=function(b,c,d){delete a.selectedKey[c],delete b[c],delete a.tableRowObjForDD[c],angular.forEach(a.tableRowObjForDD,function(b,d){"run_update"===c?(a.tableRowObjForDD[d].unshift(a.keyDDArr[1]),a.tableRowObjForDD[d].unshift(a.keyDDArr[0])):a.tableRowObjForDD[d].push({label:c,val:c})}),b[d]=""},a.fnTextBoxKeyEvent=function(a,b,c){a[b]=c},a.fnInitShopLocNextConfig=function(){a.fnCreateDD(),a.fnFetchNextConfig()},a.fnFetchNextConfig=function(){d&&b.fetchNextConfig(d).then(function(g){if(c(g)){var h=Object.keys(g).length;h!==e&&(a.isAddBtnShow=!0,a.isSaveDisabled=!1)}else a.nextConfig=g,a.isUpdated=!0,a.msg=f,a.isResetBtnShow=!0,a.isSaveDisabled=!0,b.saveNextConfig(d,g).then(function(b){null===b&&(a.isUpdated=!1,a.$$phase||a.$apply())})})},a.fnResetTable=function(b){var c=Object.keys(b).length;c===e?a.isAddBtnShow=!1:(a.isAddBtnShow=!0,a.isResetBtnShow=!1),a.isChecked=!0,a.isSaveDisabled=!1};var g={};a.fnCheckboxChange=function(a,b,c,d){d&&(g[c]=d),a?b[c]=g[c]:b[c]=""},a.fnAddRow=function(b,c){for(var d=Object.keys(b).length,f=0;f<c.length;f++)if(""!==c[f].val&&void 0===b[c[f].val]){b[c[f].val]="",a.isChecked=!0;break}d===e&&(a.isAddBtnShow=!1)},a.fnDeleteRow=function(b,c){delete b[c],delete a.selectedKey[c];var d=Object.keys(b).length;d-1!==e&&(a.isAddBtnShow=!0),
angular.forEach(a.tableRowObjForDD,function(b,d){"run_update"===c?(a.tableRowObjForDD[d].unshift(a.keyDDArr[1]),a.tableRowObjForDD[d].unshift(a.keyDDArr[0])):a.tableRowObjForDD[d].push({label:c,val:c})})},a.fnSaveNextConfig=function(c){a.isUpdated=!0,a.isChecked=!1,a.isSaveDisabled=!0,a.msg=f,b.saveNextConfig(d,c).then(function(b){null===b&&(a.isUpdated=!1,a.isChecked=!0,a.isSaveDisabled=!1,a.$$phase||a.$apply())})}}]),app.controller("repairOrderModalCtrl",["$scope","$mdDialog","repairOrder","repairOrders",function(a,b,c,d){a.repairOrder=c,a.repairOrders=d,a.item={},a.position=a.repairOrders.indexOf(a.repairOrder),a.fnMove=function(b){a.position+=b,a.repairOrder=a.repairOrders[a.position],delete a.selectedRow},a.$watch("repairOrder",function(){a.repairOrder.total_sold_price_cents=a.repairOrder.total_sold_price_cents?parseFloat(a.repairOrder.total_sold_price_cents):0,a.totalPartsSoldPrice=a.repairOrder.parts_sold_price_cents?parseFloat(a.repairOrder.parts_sold_price_cents):0;var b=a.repairOrder.parts_actual_cost_cents?parseFloat(a.repairOrder.parts_actual_cost_cents):0;a.totalLaborSoldPrice=a.repairOrder.labor_sold_price_cents?parseFloat(a.repairOrder.labor_sold_price_cents):0;var c=a.repairOrder.labor_actual_cost_cents?parseFloat(a.repairOrder.labor_actual_cost_cents):0,d=a.repairOrder.parts_discounted_cents?parseFloat(a.repairOrder.parts_discounted_cents):0,e=a.repairOrder.labor_discounted_cents?parseFloat(a.repairOrder.labor_discounted_cents):0,f=a.repairOrder.other_discounted_cents?parseFloat(a.repairOrder.other_discounted_cents):0;a.totalSubletSoldPrice=a.repairOrder.sublet_sold_price_cents?parseFloat(a.repairOrder.sublet_sold_price_cents):0;var g=a.repairOrder.sublet_actual_cost_cents?parseFloat(a.repairOrder.sublet_actual_cost_cents):0,h=a.repairOrder.sublet_discounted_cents?parseFloat(a.repairOrder.sublet_discounted_cents):0;a.partsProfitDlr=a.totalPartsSoldPrice-b,a.laborProfitDlr=a.totalLaborSoldPrice-c,a.subletProfitDlr=a.totalSubletSoldPrice-g,a.totalSoldPrice=a.totalPartsSoldPrice+a.totalLaborSoldPrice+a.totalSubletSoldPrice;var i=b+c+g,j=d+e+h+f;a.grossProfit=a.totalSoldPrice-i-j,a.discounts=d+e+f;var k,l;k=l=a.effectiveLaborRate=0,angular.forEach(a.repairOrder.labor,function(a){k+=a.sold_seconds,l+="undefined"==typeof a.sold_price_cents?0:parseFloat(a.sold_price_cents)}),l/=100,a.effectiveLaborRate=0!==k?l/k*3600:0}),a.hide=function(){b.hide()}}]),app.controller("settingsCtrl",["$scope","$stateParams",function(a,b){a.tabs=[{title:"ACCOUNT SETTINGS",viewName:"account",settingsName:"account",path:"views/authenticated/settings/account.html"},{title:"USERS",viewName:"user",settingsName:"users",path:"views/authenticated/settings/users.html"},{title:"SUBSCRIPTIONS",viewName:"subscriptions",settingsName:"subscriptions",path:"views/authenticated/settings/subscriptions.html"},{title:"TEMPLATES",viewName:"templates",settingsName:"templates",path:"views/authenticated/settings/templates.html"},{title:"UPDATES",viewName:"updates",settingsName:"updates",path:"views/authenticated/settings/updates.html"}],a.tabInit=function(){for(var c=0;c<a.tabs.length;c++)a.tabs[c].settingsName===b.settingsName&&(a.selectedIndex=c)}}]),app.controller("accountCtrl",["$scope","accountServices","toastr","globalTimeZone","$stateParams",function(a,b,c,d,e){a.isProcessing=!1,a.updateAccountForm=function(){CarglyPartner.accountInfo&&(a.user={businessName:CarglyPartner.accountInfo.businessName,website:CarglyPartner.accountInfo.website,address:CarglyPartner.accountInfo.address,city:CarglyPartner.accountInfo.city,state:CarglyPartner.accountInfo.state,zip:CarglyPartner.accountInfo.zip,timezone:CarglyPartner.accountInfo.timezone,contactName:CarglyPartner.accountInfo.contactName,paymentProcessingSecretKey:CarglyPartner.accountInfo.paymentProcessingSecretKey,paymentProcessingPublicKey:CarglyPartner.accountInfo.paymentProcessingPublicKey,paymentProcessingAccountId:CarglyPartner.accountInfo.paymentProcessingAccountId},a.email=CarglyPartner.accountInfo.email)},a.fetchAccount=function(){a.isProcessing=!0,b.fetchAccount(CarglyPartner.user.id).then(function(b){a.isProcessing=!1,CarglyPartner.accountInfo=b,a.updateAccountForm()})},a.fnCancelAccount=function(){a.fetchAccount()},a.updateUser=function(){var d=CarglyPartner.user.id;0===d.length&&(d=null),a.isProcessing=!0,b.updateAccount(d,a.user).then(function(b){null===b&&(a.isProcessing=!1,c.success("Account updated successfully."),a.fetchAccount())})},a.fnInitAccount=function(){a.timeZoneDDOptions=d,"account"==e.settingsName&&a.fetchAccount()}}]),app.controller("usersCtrl",["$scope","$mdSidenav","$mdDialog","$stateParams","userService",function(a,b,c,d,e){a.rightView="views/authenticated/settings/manageUser.html",a.locHoverMsg="",a.fnNewUserView=function(){a.userName="New User",a.fnOpenSwap()},a.getPagedDataAsync=function(){setTimeout(function(){e.fetchUsers().then(function(b){0!==b.length?(a.isDataNotNull=!0,a.isMsgShow=!1,CarglyPartner.users=b,a.usersData=b):(a.isDataNotNull=!1,a.isMsgShow=!0)})},100)},a.$on("refreshUsers",function(){a.getPagedDataAsync()}),a.userAction='<div layout="row"><md-button class="md-icon-button md-primary" ng-click="grid.appScope.fnUserEdit(row,$event)">   <md-icon md-font-set="material-icons">edit</md-icon>	<md-tooltip ng-if="$root.isMobile === null" md-direction="top">Edit</md-tooltip></md-button><md-button class="md-icon-button md-warn" ng-click="grid.appScope.fnUserDelete(row,$event)">   <md-icon md-font-set="material-icons">delete</md-icon>	<md-tooltip ng-if="$root.isMobile === null" md-direction="top">Delete</md-tooltip></md-button></div>',a.usersGrid={data:"usersData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,columnDefs:[{field:"name",displayName:"Name",minWidth:200,enableHiding:!1},{field:"email",displayName:"Email",minWidth:200,enableHiding:!1},{field:"role",displayName:"Role",minWidth:80,enableHiding:!1},{field:"verified",displayName:"Verified",minWidth:80,enableHiding:!1},{name:"Action",displayName:"",cellTemplate:a.userAction,width:100,enableSorting:!1,enableColumnMenu:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnUserDelete=function(b,d){var f=c.confirm().title("Delete").content("Would you like to delete this user?").ariaLabel("Delete").ok("Delete").cancel("Cancel").targetEvent(d);c.show(f).then(function(){e.deleteUser(b.entity.id).then(function(){a.getPagedDataAsync()})})},a.fnUserEdit=function(b){a.intIndex=b.rowIndex,a.userName=b.entity.name,e.setUserObj(b.entity),a.fnOpenSwap()},a.fnOpenSwap=function(){setTimeout(function(){a.rightView="",a.$apply(),a.rightView="views/authenticated/settings/manageUser.html",a.$apply(),b("userSwap").open().then(function(){})})},a.fnCloseSwap=function(){b("userSwap").close().then(function(){})},a.fnInitUsers=function(){"users"==d.settingsName&&a.getPagedDataAsync()}}]),app.controller("manageUsersCtrl",["$scope","$rootScope","toastr","userService","locationService",function(a,b,c,d,e){a.isProcessing=!1,d.getUserObj().id?(a.user=angular.copy(d.getUserObj()),a.user.verified="true"===d.getUserObj().verified,d.setUserObj({})):a.user={name:"",email:"",role:"User",defaultLocation:"",customerContact:"false",verified:""},a.fnInitUser=function(){a.fnFetchLocations()},a.fnSaveUser=function(e){var f=null;e.id&&(f=e.id),a.isProcessing=!0,a.userForm.$invalid=!0,d.saveUser(f,e).then(function(d){null===d?(c.success("User saved successfully."),null===f&&a.fnResetForm(),a.isProcessing=!1,a.userForm.$invalid=!1,b.$broadcast("refreshUsers"),a.fnCloseSwap()):(c.error("User can't saved. Repeated email or invalid information."),a.isProcessing=!1)})},a.fnResetForm=function(){a.user={role:"User",customerContact:!1,verified:!1},a.userForm.name.$touched=!1,a.userForm.email.$touched=!1,a.fnFetchLocations()},a.fnFetchLocations=function(){e.fetchLocation().then(function(b){a.locations=b,a.user.id||(a.user.defaultLocation=b[0].id)})}}]),app.controller("subscriptionsCtrl",["$scope","$mdSidenav","$mdDialog","toastr","$stateParams","subscriptionService",function(a,b,c,d,e,f){a.rightView="views/authenticated/settings/manageSubscription.html",a.fnNewSubscriptionView=function(){a.editSubscriptionName="New Subscription",a.isNameEditable=!1,a.fnOpenSwap()},a.getPagedDataAsync=function(){setTimeout(function(){f.fetchSubscriptions().then(function(b){var c=b.subscription_definitions;0!==c.length?(a.isDataNotNull=!0,a.isMsgShow=!1,a.subscriptionsData=c):(a.isDataNotNull=!1,a.isMsgShow=!0)})},100)},a.$on("refreshSubscriptions",function(){a.getPagedDataAsync()}),a.subscriptionAction='<div layout="row"><md-button class="md-icon-button md-primary" ng-click="grid.appScope.fnSubscriptionEdit(row,$event)">   <md-icon md-font-set="material-icons">edit</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Edit</md-tooltip></md-button><md-button class="md-icon-button md-warn" ng-click="grid.appScope.fnSubscriptionDelete(row,$event)">   <md-icon md-font-set="material-icons">delete</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Delete</md-tooltip></md-button></div>',a.subscriptionGridOptions={data:"subscriptionsData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,columnDefs:[{field:"name",displayName:"Name",minWidth:200,enableHiding:!1},{field:"description",displayName:"Description",minWidth:200,enableHiding:!1},{field:"amount_cents",displayName:"Amount",cellFilter:"CentToDollar | currency",minWidth:100,enableHiding:!1},{name:"Action",displayName:"",cellTemplate:a.subscriptionAction,width:100,enableColumnMenu:!1,enableSorting:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnSubscriptionDelete=function(b,e){var g=c.confirm().title("Delete").content("Would you like to delete this subscription?").ariaLabel("Delete").ok("Delete").cancel("Cancel").targetEvent(e);c.show(g).then(function(){f.deleteSubscription(b.entity.name).then(function(b){null===b?a.getPagedDataAsync():d.error("Subscription not deleted.")})})},a.fnSubscriptionEdit=function(b){a.intIndex=b.rowIndex,a.editSubscriptionName=b.entity.description,a.isNameEditable=!0,f.setSubscriptionObj(b.entity),a.fnOpenSwap()},a.fnOpenSwap=function(){setTimeout(function(){a.rightView="",a.$apply(),a.rightView="views/authenticated/settings/manageSubscription.html",a.$apply(),b("subscriptionSwap").open().then(function(){})})},a.fnCloseSwap=function(){b("subscriptionSwap").close().then(function(){f.setSubscriptionObj({})})},a.fnInitSubscriptions=function(){"subscriptions"==e.settingsName&&a.getPagedDataAsync()}}]),app.controller("manageSubscriptionCtrl",["$scope","toastr","$rootScope","subscriptionService",function(a,b,c,d){a.isProcessing=!1,a.subscription=d.getSubscriptionObj().name?angular.copy(d.getSubscriptionObj()):{},a.fnSaveSubscription=function(e,f){var g=angular.copy(e);g.amount_cents=100*g.amount_cents,a.isProcessing=!0,a.subscriptionForm.$invalid=!0,d.saveSubscription(g).then(function(d){null===d&&(a.isProcessing=!1,a.subscriptionForm.$invalid=!1,"New Subscription"===f&&a.fnResetForm(),b.success("Subscription saved successfully."),a.$parent.fnCloseSwap(),c.$broadcast("refreshSubscriptions"))})},a.fnInitSubscription=function(){a.subscription.amount_cents=a.subscription.amount_cents/100},a.fnResetForm=function(){a.subscription={},a.subscriptionForm.$setUntouched()}}]),app.controller("updatesCtrl",["$scope","$mdSidenav","$mdDialog","pagingOptions","updateService","$stateParams",function(a,b,c,d,e,f){a.rightView="views/authenticated/settings/manageUpdate.html",a.searchUpdateFilter="",a.fnNewUpdateView=function(){a.updateHeading="New Update",a.fnOpenSwap()},a.pagingOptions=d,a.paginationOptions={pageNumber:1,pageSize:5},a.fnFilterKeyEvent=function(b){a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber,b)},a.getPagedDataAsync=function(b,c,d){var f=/^\d+$/;f.test(c)&&(b||c||d)&&(a.isDataNotNull=!1,a.isMsgShow=!1,e.fetchUpdatesDefinitions(d,c,b).then(function(b){0!==b.length?(a.isDataNotNull=!0,a.isMsgShow=!1):(a.isDataNotNull=!1,a.isMsgShow=!0),a.updatesData=b}))},a.$on("refreshUpdates",function(){a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber)}),a.fnUpdatesPageSizeChange=function(b){b.pageNumber=1,a.getPagedDataAsync(b.pageSize,b.pageNumber)},a.fnPreviousPage=function(){a.paginationOptions.pageNumber--,a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber)},a.fnNextPage=function(){a.paginationOptions.pageNumber++,a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber)},a.updateAction='<div layout="row"><md-button class="md-icon-button md-warn" ng-click="grid.appScope.fnUpdateDelete(row,$event)">   <md-icon md-font-set="material-icons">delete</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Delete</md-tooltip></md-button></div>',a.updateGridOptions={data:"updatesData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enablePaginationControls:!1,enableVerticalScrollbar:0,columnDefs:[{field:"created",displayName:"Created",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:180,enableHiding:!1},{field:"type",displayName:"Type",minWidth:100,enableHiding:!1},{field:"package_type",displayName:"Package Type",minWidth:100,enableHiding:!1},{field:"url",displayName:"URL",minWidth:180,enableHiding:!1},{field:"signature",displayName:"Signature",minWidth:100,enableHiding:!1},{field:"version",displayName:"Version",minWidth:80,width:80,enableHiding:!1},{name:"action",displayName:"",cellTemplate:a.updateAction,width:50,enableColumnMenu:!1,enableSorting:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnUpdateDelete=function(b,d){var f=c.confirm().title("Delete").content("Would you like to delete this update?").ariaLabel("Delete").ok("Delete").cancel("Cancel").targetEvent(d);c.show(f).then(function(){e.deleteUpdateDefinitions(b.entity.id).then(function(){a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber)})})},a.fnUpdateEdit=function(b){a.updateHeading=b.entity.type,e.setUpdateObj(b.entity),a.fnOpenSwap()},a.fnOpenSwap=function(){setTimeout(function(){a.rightView="",a.$apply(),a.rightView="views/authenticated/settings/manageUpdate.html",a.$apply(),b("updateSwap").open().then(function(){})})},a.fnCloseSwap=function(){b("updateSwap").close().then(function(){})},a.fnInitUpdates=function(){"updates"==f.settingsName&&a.getPagedDataAsync(a.paginationOptions.pageSize,a.paginationOptions.pageNumber)}}]),app.controller("manageUpdatesCtrl",["$scope","$rootScope","toastr","updateService",function(a,b,c,d){function e(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}a.update=d.getUpdateObj().id?angular.copy(d.getUpdateObj()):{},a.isProcessing=!1,a.fnInitUpdate=function(){},a.fnSaveUpdate=function(f){var g=null;f.id&&(g=f.id),a.isProcessing=!0,a.updateForm.$invalid=!0,f.type="shopsync",f.package_type="ARCHIVE",d.saveUpdateDefinitions(g,f).then(function(d){e(d)?c.error("Update not saved"):(c.success("Update saved successfully."),null===g&&a.fnResetForm(),a.isProcessing=!1,a.updateForm.$invalid=!1,a.$parent.fnCloseSwap(),b.$broadcast("refreshUpdates")),b.fnCloseManageUpdate()})},a.fnResetForm=function(){a.update={},a.updateForm.$setUntouched()}}]),app.controller("templatesCtrl",["$scope","$rootScope","$timeout","$mdDialog","$mdSidenav","toastr","localStorage","templateService","$stateParams",function(a,b,c,d,e,f,g,h,i){b.rightTemplateSwapView="views/authenticated/settings/templateManage.html";var j="";a.templatesData={},a.isTemplatesDataNotNull=a.isTemplatesMsgShow=!1,a.intIndex=void 0,a.fnCreateTemplate=function(){b.editTemplateName="Create New Template",a.fnOpenTemplateSwap()},a.fnOpenTemplateSwap=function(){c(function(){b.rightTemplateSwapView="",a.$apply(),b.rightTemplateSwapView="views/authenticated/settings/templateManage.html",a.$apply(),e("manageTemplateSwap").open().then(function(){})})},b.fnCloseManageTemplate=function(){g.removeItem("preview_values"),e("manageTemplateSwap").close().then(function(){}),h.setTemplateObj({})},a.getPagedDataAsync=function(){a.isTemplatesDataNotNull=a.isTemplatesMsgShow=!1,h.fetchTemplates(j).then(function(b){0!==b.length?(a.templatesData=b,a.isTemplatesDataNotNull=!0,a.isTemplatesMsgShow=!1):(a.isTemplatesDataNotNull=!1,a.isTemplatesMsgShow=!0)},function(a){f.error("Failed retrieving templates.","STATUS CODE: "+a.status)})},a.templateAction='<div layout="row"><md-button class="md-icon-button md-primary" ng-click="grid.appScope.fnEditTemplate(row);">   <md-icon md-font-set="material-icons">edit</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Edit</md-tooltip></md-button><md-button class="md-icon-button md-warn" ng-click="grid.appScope.fnRemoveTemplate(row,$event);">   <md-icon md-font-set="material-icons">delete</md-icon>   <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Delete</md-tooltip></md-button></div>',a.templateGridOptions={data:"templatesData",rowHeight:50,multiSelect:!1,enableVerticalScrollbar:0,enableRowSelection:!0,enableRowHeaderSelection:!1,columnDefs:[{field:"name",displayName:"Name",minWidth:150,enableHiding:!1},{field:"subject",displayName:"Subject",minWidth:200,enableHiding:!1},{field:"from_name",displayName:"From Name",minWidth:150,enableHiding:!1},{name:"action",displayName:"",width:100,enableSorting:!1,enableColumnMenu:!1,cellTemplate:a.templateAction}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnEditTemplate=function(c){b.editTemplateName="Edit "+c.entity.name,h.setTemplateObj(c.entity),a.fnOpenTemplateSwap()},a.fnRemoveTemplate=function(b,c){var e=b.entity.id,g=d.confirm().title("Delete").content("Would you like to delete this template?").ariaLabel("Delete").ok("Delete").cancel("Cancel").targetEvent(c);d.show(g).then(function(){h.removeTemplate(j,e).then(function(b){f.success("Template deleted successfully..."),a.getPagedDataAsync()},function(a){f.error("Error deleting template. Please try again...","STATUS CODE: "+a.status)})})},a.$on("refreshTemplatesGrid",function(){a.getPagedDataAsync()}),a.fnInitTemplates=function(){CarglyPartner.user&&(a.userObj=CarglyPartner.user,j=a.userObj.partnerId,"templates"==i.settingsName&&a.getPagedDataAsync())}}]),app.controller("templateManageCtrl",["$scope","$rootScope","$mdDialog","toastr","localStorage","templateService",function(a,b,c,d,e,f){function g(){angular.forEach(a.preview_values,function(b,c){delete a[c]}),a.preview_values={},a.preview_values=e.getItem("preview_values")?e.getItem("preview_values"):{},a.preview_values&&angular.forEach(a.preview_values,function(b,c){a[c]=b}),"Text"===a.toggleText?a.fnGetInterpolatedTemplate("html"):a.fnGetInterpolatedTemplate("text")}var h=f.getTemplateObj();CarglyPartner.user&&(a.userObj=CarglyPartner.user),a.rendered_template={},a.toggleText="Text",a.isInterpolated=a.isToggled=!1,a.selectedIndex=0;var i={name:"",subject:"",from_address:"",from_name:"",reply_to_address:""};a.template=0!=Object.keys(h).length?angular.copy(h):i,a.previewText=a.template.text,a.template.preview_values?e.setItem("preview_values",angular.toJson(JSON.parse(h.preview_values))):(a.isInterpolated=!0,e.setItem("preview_values","{}")),a.fnSaveTemplate=function(c){var g=angular.fromJson(e.getItem("preview_values"));g&&(c.preview_values=angular.toJson(g)),c.id?f.editTemplate(a.userObj.partnerId,c).then(function(a){a.id&&d.success("Template updated successfully..."),b.fnCloseManageTemplate(),b.$broadcast("refreshTemplatesGrid")},function(a){d.error("Error updating template. Please try again...","STATUS CODE: "+a.status),b.fnCloseManageTemplate()}):f.createTemplate(a.userObj.partnerId,c).then(function(a){a.id&&d.success("Template created successfully..."),b.fnCloseManageTemplate(),b.$broadcast("refreshTemplatesGrid")},function(a){d.error("Error creating template. Please try again...","STATUS CODE: "+a.status),b.fnCloseManageTemplate()})},a.fnOpenSetTemplateVariableModal=function(a){c.show({controller:"templateVarDialogCtrl",templateUrl:"views/authenticated/settings/modals/templateVariable.dialog.html",targetEvent:a}).then(function(){g()},function(){})},a.fnTogglePreview=function(){a.isToggled=!a.isToggled,a.toggleText=a.isToggled?"HTML":"Text",a.isToggled?a.fnGetInterpolatedTemplate("text"):a.fnGetInterpolatedTemplate("html")},a.fnGetInterpolatedTemplate=function(b){var c={};a.template[b]&&(c.template=a.template[b],c.data=angular.fromJson(e.getItem("preview_values")),a.isInterpolated=!1,f.interpolateTemplate(c).then(function(c){a.rendered_template[b]=c.rendered_template,a.isInterpolated=!0,a.fnRefreshDom()},function(b){d.error("Error interpolating template. Please try again...","STATUS CODE: "+b.status),a.isInterpolated=!1}))},a.fnSendTestEmail=function(b){var g=["$scope","scope_template",function(a,b){var g={};g.template=b.html,g.data=angular.fromJson(e.getItem("preview_values")),g.from_address=b.from_address,g.subject=b.subject,a.fnSendTestEmail=function(b){g.to_address=b,f.sendTestEmail(a.userObj.partnerId,g).then(function(a){d.success("Test email sent...")},function(a){d.error("Error sending test email. Please try again...","STATUS CODE: "+a.status)}),c.cancel()},a.fnCloseDialog=function(){c.cancel()}}];c.show({controller:g,locals:{scope_template:a.template},template:'<md-dialog aria-label="Test Email dialog" style="min-width: 300px;">   <md-content layout="column" layout-padding>       <div class="md-headline"> Send Test Email </div>       <div layout="column" ng-form="testEmailForm">           <md-input-container class="remove-error-space">               <label> To Address </label>               <input type="email" name="to_address" ng-model="to_address" required />           </md-input-container>       </div>       <md-dialog-actions>           <md-button class="md-raised md-primary"                       ng-disabled="testEmailForm.to_address.$invalid"                       ng-click="fnSendTestEmail(to_address);">Send</md-button>           <md-button class="md-warn md-raised"                       ng-click="fnCloseDialog();">Cancel</md-button>       </md-dialog-actions>    </md-content></md-dialog>',targetEvent:b}).then(function(a){},function(a){})},a.fnRefreshDom=function(){a.$$phase||a.$apply()}}]),app.controller("templateVarDialogCtrl",["$scope","$mdDialog","localStorage",function(a,b,c){a.templateVarJSON=c.getItem("preview_values")?angular.fromJson(c.getItem("preview_values")):{},a.fnSetVariables=function(a){c.setItem("preview_values",angular.toJson(a)),b.hide()},a.fnCloseDialog=function(){b.cancel()}}]),angular.module("rloAdminApp").run(["$templateCache",function(a){a.put("views/authenticated/main.html",'<md-toolbar class="top-header" ng-init="fnInitMain();"> <div class="md-toolbar-tools"> <md-button ng-click="fnToggleSideNav(\'left\');" hide-gt-sm class="md-icon-button"> <md-icon aria-label="Menu">menu</md-icon> </md-button> <div layout="row" layout-align="space-between center" layout-fill> <img class="img-responsive rlo-logo" alt="Rlo training" src="images/rlo-full-logo.e3459036.png"> <md-button class="md-icon-button" ng-href="http://rlotraining.com/demo/" target="_blank"> <md-icon md-font-set="material-icons">play_circle_filled</md-icon> <md-tooltip ng-if="$root.isMobile === null" md-direction="left">Watch Video</md-tooltip> </md-button> </div> <md-menu md-position-mode="target-right target"> <md-button ng-click="$mdOpenMenu($event);"> <span ng-bind="userObj.name"></span> <md-icon md-font-set="material-icons">keyboard_arrow_down</md-icon> </md-button> <md-menu-content width="4"> <md-menu-item> <md-button ng-click="fnStateSettings();"> <div layout="row"> <p flex> <md-icon md-font-set="material-icons">settings</md-icon> Settings </p> </div> </md-button> </md-menu-item> <md-menu-item> <md-button ng-click="fnLogout();"> <div layout="row"> <p flex> <md-icon md-font-set="material-icons">power_settings_new</md-icon> Sign out </p> </div> </md-button> </md-menu-item> </md-menu-content> </md-menu> </div> </md-toolbar> <md-content layout="row" flex> <!-- Left Side Navigation : START--> <md-sidenav class="left-side-nav md-sidenav-left md-whiteframe-z2" layout="column" md-component-id="left" md-is-locked-open="$mdMedia(\'gt-sm\')"> <md-button class="md-accent" ng-class="fnIsActive(\'/clients\')" ng-click="$root.fnCloseSideNavs();" ui-sref="main.clients"> <md-icon md-font-set="material-icons">group</md-icon> Clients </md-button> <md-button class="md-accent" ng-class="fnIsActive(\'/payments\')" ng-click="$root.fnCloseSideNavs();" ui-sref="main.payments"> <md-icon md-font-set="material-icons">payment</md-icon> Payments </md-button> <md-button class="md-accent" ng-class="fnIsActive(\'/groups\')" ng-click="$root.fnCloseSideNavs();" ui-sref="main.groups"> <md-icon md-font-set="material-icons">group_work</md-icon> Shop Groups </md-button> <md-button class="md-accent" ng-class="fnIsActive(\'/shop-locations\')" ng-click="$root.fnCloseSideNavs();" ui-sref="main.shopLocations"> <md-icon md-font-set="material-icons">location_on</md-icon> Shop Locations </md-button> </md-sidenav> <!-- Left Side Navigation : END--> <!-- Body content --> <md-content id="content" class="overflow-auto" layout="column" ui-view flex></md-content> </md-content>'),a.put("views/header.html",'<div class="md-toolbar-tools" ng-controller="HeaderCtrl"> <div layout="row"> <img class="img-responsive rlo-logo" alt="Rlo training" src="images/rlo-full-logo.e3459036.png"> </div> </div>'),a.put("views/login.html",'<md-toolbar layout="row" ng-include="\'views/header.html\'"></md-toolbar> <md-content class="container-bg"> <div style="min-height: 20px"> <md-progress-linear class="md-warn" ng-if="user.isProcessing" md-mode="indeterminate"></md-progress-linear> </div> <div class="overflow-auto" layout="column" layout-align="space-between center" flex> <md-content class="md-whiteframe-z1 md-padding center-form-container" layout-margin> <div class="md-display-1 text-center" layout-padding>Sign In</div> <form name="signInForm" layout="column" novalidate> <md-input-container class="remove-error-space"> <md-icon class="md-primary">person</md-icon> <input name="contactEmail" type="email" ng-model="user.email" ng-minlength="5" placeholder="Email" required> </md-input-container> <md-input-container class="remove-error-space"> <md-icon class="md-primary">lock</md-icon> <input type="password" name="password" ng-model="user.password" minlength="5" placeholder="Password" required> </md-input-container> <div layout="column" layout-align="center center"> <div layout="row"> <md-button type="submit" class="md-raised md-primary" ng-disabled="signInForm.$invalid || user.isProcessing" ng-click="fnSignInUser(user);"> Sign In </md-button> </div> <div layout="row"> <md-button class="md-primary" ng-click="fnForgotPassword($event);"> Forgot Your Password ? </md-button> </div> </div> </form> </md-content> </div> </md-content>'),a.put("views/modals/forgotPassword.html",'<md-dialog class="forgot-password-dialog" aria-label="Forgot Password Modal"> <md-toolbar> <div class="md-toolbar-tools" layout="row" layout-align="space-between center"> <span class="md-title">Forgot Password</span> <md-button class="md-icon-button" ng-click="fnCancel();"> <md-icon md-font-set="material-icons">close</md-icon> <md-tooltip ng-if="$root.isMobile === null" md-direction="top">Close</md-tooltip> </md-button> </div> </md-toolbar> <div class="md-padding"> <md-dialog-content> <form name="forgotPasswordForm" layout="column" novalidate> <p class="text-justify"> Enter the email you registered with us previously and we\'ll send you an email with instructions on how to reset your password.</p> <md-input-container> <md-icon class="md-primary">email</md-icon> <input type="email" ng-model="resendEmail" ng-minlength="5" placeholder="Your email address" required> </md-input-container> </form> </md-dialog-content> <md-dialog-actions> <md-button class="md-raised md-primary" ng-disabled="forgotPasswordForm.$invalid" ng-click="fnResendMail(resendEmail);">Send Email </md-button> <md-button class="md-warn md-raised" ng-click="fnHide();">Cancel</md-button> </md-dialog-actions> </div> </md-dialog>'),a.put("views/modals/idleSession.tmpl.html",'<md-dialog aria-label="Idle Session Template"> <md-toolbar> <div class="md-toolbar-tools">You\'re Idle Too Long...!!</div> </md-toolbar> <md-dialog-content class="md-padding"> <div ng-init="countdown = 120"> <div ng-if="countdown <= 30"> You\'ll be logged out in {{countdown}} second(s). </div> <div ng-if="countdown > 30"> {{minRemaining}} minutes remaining. </div> </div> <md-progress-linear class="md-warn margin-top-10" md-mode="determinate" ng-value="countdown"> </md-progress-linear> </md-dialog-content> <md-dialog-actions layout-margin> <md-button class="md-raised md-accent" ng-click="extendSession();">Stay logged in</md-button> </md-dialog-actions> </md-dialog>'),a.put("views/resetPassword.html",'<md-toolbar layout="row" ng-include="\'views/header.html\'"></md-toolbar> <md-content class="container-bg"> <div style="min-height: 20px"> <md-progress-linear class="md-accent" ng-if="pass.isProcessing" md-mode="indeterminate"></md-progress-linear> </div> <div class="overflow-auto" layout="column" layout-align="space-between center" flex> <md-content class="md-whiteframe-z1 md-padding center-form-container" layout-margin> <div class="md-display-1 text-center" layout-padding>Reset Password</div> <div class="md-subhead text-center" layout-padding>Enter your new password below.</div> <form name="resetPasswordForm" layout="column" novalidate> <md-input-container class="remove-error-space"> <md-icon class="md-primary">lock</md-icon> <input type="password" placeholder="Password" name="password" ng-model="pass.password" minlength="5" required> </md-input-container> <md-input-container class="remove-error-space"> <md-icon class="md-primary">lock</md-icon> <input name="retypePassword" placeholder="Re-type Password" type="password" ng-model="pass.retypePassword" required minlength="5"> </md-input-container> <div layout="column" layout-align="center center"> <div layout="row"> <md-button type="submit" class="md-raised md-primary" ng-disabled="resetPasswordForm.$invalid || pass.isProcessing" ng-click="fnResetPassword(pass);"> Reset Password </md-button> </div> </div> </form> </md-content> </div> </md-content>')}]);